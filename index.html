<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Mora Learning</title>
    <meta name="description" content="منصة تعليم رقمية شاملة لتعلم المهارات الحديثة">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet"/>
    <link rel="preconnect" href="https://www.youtube.com">
    <link rel="preconnect" href="https://img.youtube.com">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanta/0.5.24/vanta.net.min.js"></script>
    
    <style>
        :root {
            --primary-color: #007BFF;
            --secondary-color: #F59E0B;
            --dark-bg: #1A202C;
            --light-bg: #2D3748;
            --text-color: #FFFFFF;
            --text-muted: #A0AEC0;
            --border-color: rgba(0, 123, 255, 0.2);
            --success-color: #38A169;
            --danger-color: #E53E3E;
            --font-size-base: 16px;
            --font-scale-ratio: 1.2;
        }
        .font-small { --font-size-base: 14px; }
        .font-medium { --font-size-base: 16px; }
        .font-large { --font-size-base: 18px; }
        html { font-size: var(--font-size-base); }
        .dark-theme { --primary-color: #007BFF; --secondary-color: #F59E0B; --dark-bg: #1A202C; --light-bg: #2D3748; --text-color: #FFFFFF; --text-muted: #A0AEC0; --border-color: rgba(0, 123, 255, 0.2); }
        .light-theme { --primary-color: #4C51BF; --secondary-color: #E53E3E; --dark-bg: #F7FAFC; --light-bg: #EDF2F7; --text-color: #2D3748; --text-muted: #4A5568; --border-color: rgba(76, 81, 191, 0.2); }
        .pink-theme { --primary-color: #D53F8C; --secondary-color: #9F7AEA; --dark-bg: #1A202C; --light-bg: #44337A; --text-color: #FFFFFF; --text-muted: #E2E8F0; --border-color: rgba(213, 63, 140, 0.3); }
        .green-theme { --primary-color: #38A169; --secondary-color: #38B2AC; --dark-bg: #1A202C; --light-bg: #2F855A; --text-color: #FFFFFF; --text-muted: #C6F6D5; --border-color: rgba(56, 161, 105, 0.3); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; transition: background-color 0.4s ease, color 0.4s ease; }
        body { background-color: var(--dark-bg); color: var(--text-color); min-height: 100vh; overflow-x: hidden; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        @keyframes pulse { 0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; text-shadow: 0 3px 10px rgba(0,0,0,0.4); } 50% { transform: translate(-50%, -50%) scale(1.08); opacity: 1; text-shadow: 0 5px 15px rgba(0,0,0,0.6); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25%, 75% { transform: translateX(-8px); } 50% { transform: translateX(8px); } }
        .animated { animation-duration: 0.8s; animation-fill-mode: both; }
        .fadeInUp { animation-name: fadeInUp; }
        .fadeOut { animation-name: fadeOut; animation-duration: 0.3s; }
        .back-button { display: none; background-color: var(--primary-color); color: white; border: none; padding: 0.5rem 0.875rem; border-radius: 8px; cursor: pointer; margin-bottom: 1rem; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3); align-self: flex-start; transform: scale(0.95); }
        .back-button:hover { transform: translateY(-2px) scale(1); filter: brightness(1.1); }
        .sidebar { width: 280px; background-color: var(--light-bg); height: 100vh; position: fixed; top: 0; right: -280px; padding: 1.5rem 1.25rem; overflow-y: auto; box-shadow: -4px 0 20px rgba(0, 0, 0, 0.3); transition: right 0.4s ease; z-index: 1000; display: flex; flex-direction: column; border-top-left-radius: 20px; border-bottom-left-radius: 20px; }
        .sidebar.open { right: 0; }
        .sidebar h2 { color: var(--primary-color); margin-bottom: 2rem; font-size: 1.6rem; text-align: center; font-weight: 700; }
        .sidebar-menu { list-style: none; padding: 0;}
        .sidebar-menu li { margin-bottom: 0.875rem; }
        .sidebar-menu a { display: block; color: var(--text-muted); text-decoration: none; padding: 0.75rem 1.125rem; border-radius: 12px; transition: all 0.3s; font-size: 1.15rem; font-weight: 600; }
        .sidebar-menu a:hover, .sidebar-menu a.active { background-color: var(--primary-color); color: white; transform: translateX(-5px); }
        .sidebar-footer { margin-top: auto; padding-top: 1.5rem; text-align: center; border-top: 1px solid var(--border-color); }
        .footer-text { color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.75rem; }
        .developer-info { display: flex; align-items: center; justify-content: center; gap: 10px; }
        .developer-name { color: var(--secondary-color); font-weight: 700; font-size: 1.15rem; text-decoration: none; transition: all 0.3s ease; }
        .developer-name:hover { color: #fff; text-shadow: 0 0 10px var(--secondary-color); }
        .main-content { padding: 1.25rem; transition: margin-right 0.4s; min-height: 100vh; display: flex; flex-direction: column; justify-content: space-between; }
        #content-area { flex-grow: 1; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.25rem; background-color: var(--light-bg); border-radius: 12px; margin-bottom: 1.5rem; box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15); }
        .top-bar h1 { font-size: 1.5rem; font-weight: bold; color: var(--primary-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .menu-icon { width: 40px; height: 40px; background-color: var(--primary-color); border-radius: 10px; display: flex; justify-content: center; align-items: center; cursor: pointer; color: white; font-size: 1.5rem; transition: all 0.3s ease; }
        .menu-icon:hover { transform: rotate(90deg) scale(1.1); }
        .logo-container img { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .welcome-message { text-align: center; padding: 1.5rem; margin-bottom: 1.5rem; color: var(--text-color); position: relative; overflow: hidden; border-radius: 18px; background: linear-gradient(135deg, var(--light-bg), var(--dark-bg)); box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3); border: 1px solid var(--border-color); max-width: 600px; margin: 0 auto 1.5rem; }
        .welcome-message::before, .welcome-message::after { content: ""; position: absolute; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--primary-color)); animation: shimmer 4s infinite linear; }
        .welcome-message::before { top: 0; } .welcome-message::after { bottom: 0; }
        .welcome-message h2 { font-size: 1.6rem; margin-bottom: 0.625rem; color: var(--text-color); }
        .welcome-message p { line-height: 1.7; font-size: 1.05rem; color: var(--text-muted); }
        .articles-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.375rem; }
        .category-card, .article-card { background-color: var(--light-bg); border-radius: 14px; overflow: hidden; box-shadow: 0 8px 25px rgba(0,0,0,0.3); transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); cursor: pointer; display: flex; flex-direction: column; }
        .category-card:hover, .article-card:hover { transform: translateY(-10px) scale(1.03); box-shadow: 0 16px 35px rgba(0, 123, 255, 0.3); }
        .category-card { min-height: 180px; position: relative; text-align: center; }
        .category-card img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease; }
        .category-card:hover img { transform: scale(1.1); }
        .category-text-overlay { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent 60%); color: white; padding: 1.125rem 1rem 0.75rem; text-align: center; border-radius: 0 0 14px 14px; z-index: 2; backdrop-filter: blur(2px); }
        .category-text-overlay h2 { font-size: 1.3rem; font-weight: 700; margin: 0; color: white; text-shadow: 0 2px 6px rgba(0,0,0,0.8); display: flex; flex-direction: column; gap: 4px; letter-spacing: 0.5px; }
        .category-emoji { font-size: 1.4rem; margin-bottom: 4px; } .category-title { font-size: 1.1rem; }
        .category-free { font-size: 0.85rem; color: var(--secondary-color); font-weight: 600; text-shadow: 0 1px 3px rgba(0,0,0,0.6); }
        .article-img { width: 100%; height: 150px; object-fit: cover; border-bottom: 3px solid var(--primary-color); }
        .article-content { padding: 1.125rem; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .article-title { font-size: 1.25rem; font-weight: 700; color: var(--primary-color); margin-bottom: 0.625rem; }
        .article-excerpt { color: var(--text-muted); font-size: 0.95rem; line-height: 1.6; margin-bottom: 0.75rem; }
        .read-more { display: block; margin-top: auto; color: var(--secondary-color); font-weight: 600; text-align: center; padding-top: 0.5rem; border-top: 1px dashed var(--border-color); }
        .page-content-wrapper { max-width: 820px; margin: 0 auto; padding: 0.625rem; }
        .page-content-wrapper h2, .page-content-wrapper h3 { color: var(--primary-color); margin: 1.5rem 0 0.625rem 0; padding-bottom: 0.625rem; border-bottom: 2px solid var(--primary-color); font-size: 1.75rem; }
        .page-content-wrapper h3 { font-size: 1.4rem; }
        .page-content-wrapper p, .page-content-wrapper li { margin-bottom: 1rem; text-align: justify; line-height: 1.8; color: var(--text-muted); font-size: 1.05rem; }
        .page-content-wrapper ul, .page-content-wrapper ol { list-style-position: inside; padding-right: 0; margin-right: 1rem; }
        [dir="ltr"] .page-content-wrapper ul, [dir="ltr"] .page-content-wrapper ol { padding-left: 0; margin-left: 1rem; margin-right: 0; }
        .section-title { color: var(--secondary-color); margin: 1.25rem 0; font-size: 1.5rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .support-intro { color: var(--text-muted); font-size: 1.1rem; line-height: 1.8; margin-bottom: 2rem; }
        .support-intro h2 { color: var(--primary-color); margin-bottom: 1rem; }
        .contact-methods { display: flex; flex-direction: column; gap: 1rem; }
        .contact-item { display: flex; align-items: center; gap: 1rem; padding: 0.75rem; border-radius: 12px; transition: all 0.3s ease; background-color: transparent; border: 1px solid transparent; }
        .contact-item:hover { transform: translateX(-8px); background-color: var(--light-bg); border-color: var(--border-color); }
        .contact-icon { width: 32px; height: 32px; fill: var(--primary-color); transition: fill 0.3s; flex-shrink: 0; }
        .contact-text { font-size: 1.15rem; color: var(--text-color); transition: color 0.3s; }
        .contact-link { color: inherit; text-decoration: none; }
        .setting-item { margin-bottom: 2rem; }
        .setting-item h3 { color: var(--secondary-color); font-size: 1.3rem; margin-bottom: 1rem; padding-bottom: 5px; border-bottom: 1px solid var(--border-color); }
        .theme-options, .language-options, .font-size-options { display: flex; gap: 10px; flex-wrap: wrap; }
        .theme-option, .language-option, .font-size-option { padding: 10px 20px; border-radius: 8px; cursor: pointer; transition: all 0.3s; border: 2px solid var(--light-bg); background-color: var(--light-bg); color: var(--text-muted); }
        .theme-option.selected, .language-option.selected, .font-size-option.selected { border-color: var(--primary-color); color: var(--primary-color); font-weight: bold; }
        .theme-option:hover, .language-option:hover, .font-size-option:hover { filter: brightness(1.2); }
        .video-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.25rem; }
        .video-item { position: relative; border-radius: 12px; overflow: hidden; transition: transform 0.3s; background-color: var(--light-bg); display: flex; flex-direction: column; box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .video-item:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0, 123, 255, 0.2); }
        .video-thumbnail { position: relative; cursor: pointer; aspect-ratio: 16/9; background-color: #000; }
        .video-thumbnail img { width: 100%; height: 100%; object-fit: cover; display: block; transition: opacity 0.3s; }
        .video-thumbnail:hover img { opacity: 0.7; }
        .video-thumbnail .play-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 3rem; color: white; background-color: rgba(0,0,0,0.5); border-radius: 50%; width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; transition: background-color 0.3s; backdrop-filter: blur(2px); }
        .video-thumbnail:hover .play-icon { background-color: rgba(0, 123, 255, 0.8); }
        .video-actions { display: flex; justify-content: space-around; padding: 0.75rem; border-top: 1px solid var(--border-color); margin-top: auto; }
        .video-btn { flex: 1; padding: 0.5rem 0.75rem; border: none; border-radius: 8px; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-align: center; text-decoration: none; color: white; }
        .watch-btn { background-color: var(--primary-color); margin: 0 5px; }
        .watch-btn:hover { filter: brightness(1.2); }
        .download-btn { background-color: var(--secondary-color); margin: 0 5px; }
        .download-btn:hover { filter: brightness(1.2); }
        .video-item iframe, .video-player-unlocked iframe { width: 100%; height: auto; aspect-ratio: 16/9; display: block; border: none; }
        .video-player-unlocked { width: 100%; aspect-ratio: 16/9; background-color: #000; }
        .paid-course-card-new {
            background-color: var(--light-bg);
            border-radius: 14px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        .paid-course-card-new:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 123, 255, 0.2);
        }
        .paid-thumbnail-new {
            position: relative;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            aspect-ratio: 16/9;
            overflow: hidden;
        }
        .lock-icon-new {
            font-size: 4rem;
            color: white;
            text-shadow: 0 3px 10px rgba(0,0,0,0.4);
            animation: pulse 2s infinite ease-in-out;
            transform: translate(-50%, -50%);
            position: absolute;
            top: 50%;
            left: 50%;
            z-index: 2;
            opacity: 0.8;
        }
        .paid-content-new {
            padding: 1rem;
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .course-title-new {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 0.75rem;
            line-height: 1.4;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.75rem;
        }
        .course-price-new {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--success-color);
            margin-bottom: 1.25rem;
        }
        .buy-now-btn-new {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: auto;
        }
        .buy-now-btn-new:hover {
            filter: brightness(1.2);
            transform: scale(1.03);
        }
        .payment-modal-overlay { 
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
            background-color: rgba(0,0,0,0.7); z-index: 2000; 
            justify-content: center; align-items: center; 
            backdrop-filter: blur(5px); animation: fadeInUp 0.3s; 
        }
        .payment-modal-content { 
            background-color: var(--light-bg); padding: 2rem; border-radius: 15px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); width: 90%; max-width: 450px; 
            text-align: center; position: relative; 
            border: 1px solid var(--primary-color); animation: none; 
        }
        .close-modal-btn { 
            position: absolute; top: 10px; left: 15px; font-size: 2rem; 
            font-weight: bold; color: var(--text-muted); cursor: pointer; transition: all 0.3s; 
        }
        .close-modal-btn:hover { color: var(--danger-color); transform: scale(1.2); }
        [dir="rtl"] .close-modal-btn { left: auto; right: 15px; }
        .payment-modal-content h2 { color: var(--primary-color); margin-bottom: 1rem; }
        .payment-modal-content p { font-size: 1.1rem; line-height: 1.7; color: var(--text-color); margin-bottom: 1rem; }
        .payment-phone-number { 
            color: var(--success-color); font-weight: 700; text-decoration: none; 
            display: inline-block; transition: all 0.3s ease; 
            font-size: 1.25rem; letter-spacing: 1px;
        }
        .payment-phone-number:hover { transform: scale(1.05); text-shadow: 0 0 10px var(--success-color); filter: brightness(1.2); }
        .purchase-modal-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        .btn-purchase-modal {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: none;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
            display: block;
            text-align: center;
        }
        .btn-purchase-modal:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }
        .btn-call {
            background-color: var(--primary-color);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
        .btn-enter-pass {
            background-color: var(--success-color);
             box-shadow: 0 4px 15px rgba(56, 161, 105, 0.3);
        }
        .btn-close {
            background-color: var(--danger-color);
             box-shadow: 0 4px 15px rgba(229, 62, 62, 0.3);
        }
        .password-input-container { position: relative; margin-top: 2rem; margin-bottom: 1rem; }
        #password-input-field { width: 100%; background-color: var(--dark-bg); border: 2px solid var(--border-color); color: var(--text-color); padding: 14px; border-radius: 12px; font-size: 1.1rem; outline: none; transition: all 0.3s ease; letter-spacing: 3px; }
        #password-input-field:focus { border-color: var(--primary-color); box-shadow: 0 0 15px rgba(0, 123, 255, 0.4); }
        .password-input-container label { color: var(--text-muted); position: absolute; top: 14px; right: 15px; font-size: 1rem; transition: all 0.3s ease; pointer-events: none; background-color: var(--light-bg); padding: 0 5px; }
        [dir="ltr"] .password-input-container label { right: auto; left: 15px; }
        #password-input-field:focus + label, #password-input-field:not(:placeholder-shown) + label { top: -12px; font-size: 0.9rem; color: var(--primary-color); }
        #password-submit-btn { margin-top: 1.5rem; padding: 0.8rem 2.5rem; font-size: 1.1rem; }
        .blog-textarea { background: transparent; border: none; outline: none; box-shadow: none; color: var(--text-color); font-size: 1.1rem; line-height: 1.8; width: 100%; min-height: 400px; padding: 1.25rem; resize: none; border-bottom: 1px solid var(--border-color); }
        .blog-save-btn { display: block; margin: 1.25rem auto 0; padding: 0.75rem 2rem; background-color: var(--primary-color); color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3); transition: all 0.3s ease; }
        .blog-save-btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .profit-calculator-container { max-width: 900px; margin: 1.25rem auto; padding: 2rem; background: linear-gradient(145deg, var(--dark-bg), var(--light-bg)); border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.4); border: 1px solid var(--border-color); }
        .calculator-header { text-align: center; margin-bottom: 2rem; } .calculator-header h2 { font-size: 2rem; color: var(--primary-color); font-weight: 700; } .calculator-header p { font-size: 1.1rem; color: var(--text-muted); max-width: 500px; margin: 10px auto 0; }
        .calculator-form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2.5rem; }
        .form-group { position: relative; } .form-group label { color: var(--text-muted); position: absolute; top: 14px; right: 15px; font-size: 1rem; transition: all 0.3s ease; pointer-events: none; background-color: var(--light-bg); padding: 0 5px; } [dir="ltr"] .form-group label { right: auto; left: 15px; } .form-group input { background-color: var(--light-bg); border: 2px solid var(--border-color); color: var(--text-color); padding: 14px; border-radius: 12px; font-size: 1.1rem; outline: none; transition: border-color 0.3s, box-shadow 0.3s; width: 100%; } input[type=number] { -moz-appearance: textfield; } input[type=number]::-webkit-outer-spin-button, input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; } .form-group input:focus { border-color: var(--primary-color); box-shadow: 0 0 15px rgba(0, 123, 255, 0.4); } .form-group input:focus + label, .form-group input:not(:placeholder-shown) + label { top: -12px; font-size: 0.9rem; color: var(--primary-color); }
        .calculator-actions { text-align: center; margin-bottom: 2.5rem; } .calculate-btn { background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: white; padding: 1rem 3.125rem; font-size: 1.3rem; font-weight: bold; border-radius: 15px; border: none; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4); letter-spacing: 1px; } .calculate-btn:hover { transform: translateY(-4px) scale(1.05); box-shadow: 0 10px 30px rgba(245, 158, 11, 0.5); filter: brightness(1.2); }
        .calculator-results-container { display: none; padding-top: 1.25rem; } .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; } .result-card { background-color: var(--light-bg); border-radius: 15px; padding: 1.5rem; text-align: center; border-left: 5px solid var(--secondary-color); box-shadow: 0 8px 20px rgba(0,0,0,0.2); transition: all 0.3s ease; } [dir="ltr"] .result-card { border-left: none; border-right: 5px solid var(--secondary-color); } .result-card:hover { transform: translateY(-5px); } .result-card .result-item-label { font-size: 1.1rem; color: var(--text-muted); margin-bottom: 0.75rem; display: block; } .result-card .result-item-value { font-size: 2rem; font-weight: bold; display: block; word-wrap: break-word; } .result-card.profit { border-color: var(--success-color); } .result-card.loss { border-color: var(--danger-color); } .result-card.profit .result-item-value { color: var(--success-color); text-shadow: 0 0 10px rgba(56, 161, 105, 0.5); } .result-card.loss .result-item-value { color: var(--danger-color); text-shadow: 0 0 10px rgba(229, 62, 62, 0.5); }
        .app-info-logo { width: 120px; height: 120px; border-radius: 50%; margin-bottom: 1.5rem; border: 4px solid var(--primary-color); box-shadow: 0 8px 30px rgba(0, 123, 255, 0.5); transition: transform 0.5s ease, box-shadow 0.5s ease; } .app-info-logo:hover { transform: scale(1.1) rotate(5deg); box-shadow: 0 12px 40px rgba(0, 123, 255, 0.7); } .app-info-details { margin-top: 3rem; width: 100%; display: flex; flex-direction: column; align-items: center; gap: 2rem; } .cinematic-info-item { text-align: center; width: 100%; border-bottom: 1px solid var(--border-color); padding-bottom: 1.25rem; } .cinematic-info-item:last-child { border-bottom: none; } .info-label { font-size: 1rem; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 0.5rem; display: block; } .info-value { font-size: 1.8rem; font-weight: 700; color: var(--text-color); text-shadow: 0 0 8px rgba(255, 255, 255, 0.1); word-wrap: break-word; } .info-value.developer { color: var(--secondary-color); text-shadow: 0 0 15px rgba(245, 158, 11, 0.5); }
        footer { text-align: center; margin-top: auto; padding: 0.75rem; color: var(--text-muted); font-size: 0.85rem; border-top: 1px solid var(--border-color); width: 100%; background-color: var(--dark-bg); box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2); } footer p { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; letter-spacing: 0.5px; }
        
        /* --- LOGIN/SIGNUP STYLES (TRANSPARENT/GLOWING) --- */
        #login-overlay {
            display: none; 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--dark-bg);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #vanta-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        .auth-form-container {
            position: relative;
            z-index: 2;
            width: 90%;
            max-width: 400px;
            background: transparent; 
            backdrop-filter: none; 
            border-radius: 0; 
            padding: 0; 
            border: none; 
            box-shadow: none; 
            animation: fadeInUp 0.5s ease;
            text-align: center; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        .auth-form-container h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 2.5rem; 
            font-size: 2.2rem; 
            font-weight: 700;
            text-shadow: 0 0 10px var(--primary-color), 0 0 20px rgba(0, 123, 255, 0.7);
        }
        #auth-initial-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem; /* Reduced gap */
            width: 100%;
            max-width: 250px; /* Reduced max-width */
            margin-bottom: 2rem;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .auth-fields-container {
            display: none; 
            width: 100%;
            transition: opacity 0.3s ease, transform 0.3s ease;
            opacity: 0; 
            transform: translateY(20px); 
        }
        .auth-fields-container.visible {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .auth-form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        .auth-form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-color); 
            font-weight: 600;
            text-shadow: 0 0 5px var(--text-color);
            text-align: right; 
        }
        [dir="ltr"] .auth-form-group label {
            text-align: left; 
        }
        .auth-form-group input,
        .auth-form-group select {
            width: 100%;
            padding: 0.875rem 0.5rem;
            background-color: rgba(0, 0, 0, 0.2); 
            border: none;
            border-bottom: 2px solid var(--primary-color); 
            border-radius: 0;
            color: var(--text-color);
            font-size: 1.1rem;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px var(--text-color);
            box-shadow: 0 5px 15px -5px rgba(0, 123, 255, 0.3); 
        }
        .auth-form-group input::placeholder {
            color: var(--text-muted);
            opacity: 0.7;
            text-shadow: none; 
        }
        .auth-form-group input:focus,
        .auth-form-group select:focus {
            box-shadow: 0 8px 20px -5px rgba(245, 158, 11, 0.6); 
            outline: none;
            border-bottom-color: var(--secondary-color); 
        }
        .auth-form-group select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23A0AEC0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: left 0.5rem center;
            padding-left: 2.5rem;
        }
        [dir="rtl"] .auth-form-group select {
            background-position: right 0.5rem center;
            padding-left: 0.5rem;
            padding-right: 2.5rem;
        }
        .auth-fields-container .auth-btn {
             margin-top: 1.5rem; 
        }
        .auth-switch-link {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--text-muted);
        }
        .auth-switch-link a {
            color: var(--secondary-color);
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
        }
        .auth-switch-link a:hover {
            text-decoration: underline;
        }
        
        /* MODIFIED: Initial Buttons Styling */
        .auth-btn-initial {
            padding: 0.6rem 1rem; /* Smaller padding */
            font-size: 1.0rem; /* Smaller font size */
            font-weight: 600; /* Adjusted font weight */
            border: none;
            border-radius: 8px; /* Slightly smaller radius */
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            width: 100%; 
            background-color: rgba(0, 123, 255, 0.5); /* Transparent Blue */
            box-shadow: 0 0 8px var(--primary-color), 0 0 15px rgba(0, 123, 255, 0.6); /* Glowing effect */
        }
        .auth-btn-initial:hover {
            background-color: rgba(0, 123, 255, 0.7); /* Slightly less transparent on hover */
            box-shadow: 0 0 12px var(--primary-color), 0 0 25px rgba(0, 123, 255, 0.8); /* Stronger glow on hover */
            transform: translateY(-2px);
        }

        /* --- END LOGIN STYLE MODS --- */
        
        /* --- ADMIN PANEL STYLES (Blue Theme) --- */
        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .admin-stat-card {
            background-color: var(--light-bg);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            border-left: 5px solid var(--primary-color); /* Blue border */
        }
        [dir="ltr"] .admin-stat-card {
            border-left: none;
            border-right: 5px solid var(--primary-color); /* Blue border */
        }
        .admin-stat-card h3 {
            font-size: 1.1rem;
            color: var(--text-muted);
            margin: 0 0 0.75rem 0;
            border: none;
            padding: 0;
        }
        .admin-stat-card p {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-color);
            margin: 0;
        }
        .admin-section {
            background-color: var(--light-bg);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            border: 1px solid var(--border-color); /* Subtle blue border */
        }
        .admin-section h3 {
            color: var(--primary-color); /* Blue heading */
            font-size: 1.5rem;
            margin-top: 0;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color); /* Blue border */
        }
        .admin-user-table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
        }
        .admin-user-table th,
        .admin-user-table td {
            padding: 0.875rem 1rem;
            text-align: right;
            border-bottom: 1px solid var(--border-color); /* Blue border */
            color: var(--text-muted);
            white-space: nowrap;
        }
        [dir="ltr"] .admin-user-table th,
        [dir="ltr"] .admin-user-table td {
            text-align: left;
        }
        .admin-user-table th {
            color: var(--primary-color); /* Blue header text */
            font-size: 1rem;
        }
        .admin-user-table td {
            font-size: 0.95rem;
        }
        .admin-user-table tr:last-child td {
            border-bottom: none;
        }
        .admin-user-table tr:hover {
            background-color: rgba(0, 123, 255, 0.1); /* Light blue hover */
        }
        .admin-btn {
            padding: 0.5rem 0.875rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            margin: 0 4px;
        }
        .admin-btn.btn-delete {
            background-color: var(--danger-color);
        }
        /* Blue admin buttons */
        .admin-btn.btn-ban, 
        .admin-btn.btn-login { 
            background-color: var(--primary-color); 
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }
        .admin-btn:hover {
            filter: brightness(1.2);
        }
        .admin-form-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }
        .admin-form-group label {
            font-weight: 600;
            color: var(--text-muted);
            flex-shrink: 0;
        }
        .admin-form-group input {
            width: 100%;
            max-width: 150px;
            padding: 0.5rem 0.75rem;
            background-color: var(--dark-bg);
            border: 2px solid var(--border-color); /* Blue border */
            border-radius: 8px;
            color: var(--text-color);
        }
        .admin-form-group input:focus {
             border-color: var(--primary-color);
             box-shadow: 0 0 5px var(--primary-color);
        }
        .password-manager-item {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border-color); /* Blue border */
        }
        .password-manager-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .password-manager-item h4 {
            color: var(--text-color);
            font-size: 1.2rem;
            margin-bottom: 0.75rem;
        }
        .password-manager-item textarea {
            width: 100%;
            min-height: 150px;
            background-color: var(--dark-bg);
            border: 2px solid var(--border-color); /* Blue border */
            border-radius: 8px;
            color: var(--text-color);
            padding: 0.75rem;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .password-manager-item textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 5px var(--primary-color);
        }

        /* --- END ADMIN BLUE THEME --- */
        
        /* --- RATING MODAL --- */
        #rating-modal-overlay {
            display: none; 
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            animation: fadeInUp 0.3s;
        }
        .rating-modal-content {
            background-color: var(--light-bg);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
            border: 1px solid var(--primary-color);
        }
        .rating-modal-content h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        .rating-modal-content p {
            font-size: 1.1rem;
            line-height: 1.7;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }
        .star-rating {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            direction: ltr; /* Always LTR for stars */
        }
        .star-rating .star {
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .star-rating .star:hover,
        .star-rating .star.selected {
            color: var(--secondary-color);
            transform: scale(1.2);
        }


        @media (max-width: 768px) { 
            .sidebar { width: 100%; right: -100%; border-radius: 0; } 
            .sidebar.open { right: 0; } 
            .main-content { padding: 1rem; } 
            .welcome-message { padding: 1.25rem; } 
            .article-title { font-size: 1.15rem; } 
            .top-bar h1 { font-size: 1.4rem; } 
            .video-list, .results-grid, .admin-stats-grid { grid-template-columns: 1fr; } 
            .profit-calculator-container { padding: 1.25rem; } 
            .calculator-header h2 { font-size: 1.8rem; } 
            .page-content-wrapper h2 { font-size: 1.5rem; } 
            .page-content-wrapper h3 { font-size: 1.2rem; } 
            .page-content-wrapper p, .page-content-wrapper li { font-size: 1rem; } 
            .app-info-logo { width: 100px; height: 100px; } 
            .section-title { font-size: 1.3rem; } 
        }
        @media (max-width: 480px) { 
            html { --font-size-base: 15px; } 
            .font-small { --font-size-base: 13px; } 
            .font-medium { --font-size-base: 15px; } 
            .font-large { --font-size-base: 17px; } 
            .category-card h2 { font-size: 1.2rem; } 
            .welcome-message h2 { font-size: 1.4rem; } 
            .welcome-message p { font-size: 0.95rem; } 
            .calculate-btn { padding: 0.875rem 2.5rem; font-size: 1.1rem; } 
            .result-card .result-item-value { font-size: 1.8rem; } 
            .info-value { font-size: 1.5rem; } 
            .payment-modal-content { padding: 2rem 1rem; } 
            .top-bar h1 { font-size: 1.2rem;} 
            .menu-icon { width: 35px; height: 35px; font-size: 1.3rem; } 
            .logo-container img { width: 35px; height: 35px; } 
            .back-button { padding: 0.4rem 0.75rem; font-size: 0.85rem;} 
            .auth-form-container { padding: 0 1.5rem; } 
            .auth-form-container h2 { font-size: 1.8rem; }
            .star-rating { font-size: 2rem; }
        }
    </style>
</head>
<body class="dark-theme font-medium">

    <div id="login-overlay">
        <div id="vanta-bg"></div>
        
        <div class="auth-form-container">
            <h2 data-lang-key="app_name">Mora Learning</h2> 

            <div id="auth-initial-buttons">
                 <button id="show-signup-btn" class="auth-btn-initial btn-signup" onclick="showSignupFields()" data-lang-key="signup_title">إنشاء حساب</button>
                 <button id="show-login-btn" class="auth-btn-initial btn-login" onclick="showLoginFields()" data-lang-key="login_title">تسجيل الدخول</button>
            </div>

            <div id="login-fields" class="auth-fields-container">
                <div class="auth-form-group">
                    <label for="login-name" data-lang-key="login_name">الاسم</label>
                    <input type="text" id="login-name" autocomplete="username" placeholder="...اكتب اسمك">
                </div>
                <div class="auth-form-group">
                    <label for="login-pass" data-lang-key="login_pass">كلمة المرور</label>
                    <input type="password" id="login-pass" autocomplete="current-password" placeholder="...اكتب كلمة المرور">
                </div>
                <button class="auth-btn btn-login" onclick="handleLogin()" data-lang-key="login_btn">دخول</button>
                <p class="auth-switch-link" data-lang-key="login_switch">
                    ليس لديك حساب؟ <a onclick="showSignupFields()">إنشاء حساب</a>
                </p>
            </div>

            <div id="signup-fields" class="auth-fields-container">
                <div class="auth-form-group">
                    <label for="signup-name" data-lang-key="signup_name">الاسم</label>
                    <input type="text" id="signup-name" autocomplete="name" placeholder="...اختر اسم فريد">
                </div>
                <div class="auth-form-group">
                    <label for="signup-age" data-lang-key="signup_age">السن</label>
                    <input type="number" id="signup-age" placeholder="...اكتب سنك">
                </div>
                <div class="auth-form-group">
                    <label for="signup-gender" data-lang-key="signup_gender">النوع</label>
                    <select id="signup-gender">
                        <option value="male" data-lang-key="gender_male">ذكر</option>
                        <option value="female" data-lang-key="gender_female">أنثى</option>
                    </select>
                </div>
                <div class="auth-form-group">
                    <label for="signup-pass" data-lang-key="signup_pass">كلمة المرور</label>
                    <input type="password" id="signup-pass" autocomplete="new-password" placeholder="8+ حروف وأرقام">
                </div>
                <button class="auth-btn btn-signup" onclick="handleSignup()" data-lang-key="signup_btn">إنشاء</button>
                <p class="auth-switch-link" data-lang-key="signup_switch">
                    لديك حساب بالفعل؟ <a onclick="showLoginFields()">تسجيل الدخول</a>
                </p>
            </div>
        </div>
    </div>
    <aside class="sidebar" id="sidebar">
          <h2 data-lang-key="app_name">Mora Learning</h2>
        <ul class="sidebar-menu" id="sidebar-menu">
            <li><a href="#" onclick="showSection('home')" data-lang-key="home">الرئيسية</a></li>
            <li><a href="#" onclick="showSection('articles')" data-lang-key="articles">المقالات</a></li>
            <li><a href="#" onclick="showSection('blog')" data-lang-key="blog">مدونة</a></li>
            <li><a href="#" onclick="showSection('profit_calculator')" data-lang-key="profit_calculator">حاسبة الأرباح</a></li>
            <li><a href="#" onclick="showSection('paid_courses')" data-lang-key="paid_courses">كورسات مدفوعه</a></li>
            <li><a href="#" onclick="showSection('settings')" data-lang-key="settings">الإعدادات</a></li>
            <li><a href="#" onclick="showSection('support')" data-lang-key="support">الدعم الفني</a></li>
            <li><a href="#" onclick="showSection('privacy_policy')" data-lang-key="privacy_policy">سياسة الخصوصية</a></li>
            <li><a href="#" onclick="showSection('app_info')" data-lang-key="app_info">معلومات التطبيق</a></li>
            <li id="admin-panel-link" style="display: none;"><a href="#" onclick="showSection('admin_panel')" data-lang-key="admin_panel">لوحة التحكم</a></li>
            <li id="logout-link" style="display: none;"><a href="#" onclick="handleLogout()" data-lang-key="logout">تسجيل الخروج</a></li>
        </ul>
        <div class="sidebar-footer">
            <p class="footer-text" data-lang-key="developed_by">تم التطوير بواسطة</p>
            <div class="developer-info">
                <a href="#" class="developer-name">Amr Lotfy</a>
            </div>
        </div>
    </aside>
    <div class="main-content" id="main-content">
        <header class="top-bar">
            <div class="logo-container" style="display: flex; align-items: center; gap: 10px;">
                <img src="https://i.postimg.cc/Nf0Sr2zg/file-00000000d52862468b52a49178cf0009.png" alt="Mora Learning Logo" style="height: 40px; width: 40px; border-radius: 50%; border: 2px solid var(--primary-color); box-shadow: 0 0 15px rgba(0, 123, 255, 0.5);">
                <h1 id="page-title">Mora Learning</h1>
            </div>
            <div class="menu-icon" onclick="toggleSidebar()" title="القائمة">☰</div>
        </header>
        <button class="back-button" id="back-button" onclick="goBack()" data-lang-key="back_button">الرجوع</button>
        <div class="welcome-message animated fadeInUp" id="welcome-message">
            <h2 data-lang-key="welcome_main_title">ابدأ رحلتك الرقمية مع Mora Learning</h2>
            <p data-lang-key="welcome_main_subtitle">منصة التعلم الشاملة لعام 2025، حيث تبدأ رحلتك نحو التميز.</p>
        </div>
        <main id="content-area"></main>
        <footer>
            <p data-lang-key="footer_rights">جميع الحقوق محفوظة © Mora Learning 2025</p>
        </footer>
    </div>
    <div id="purchase-modal" class="payment-modal-overlay" onclick="closePurchaseModal()">
        <div class="payment-modal-content" onclick="event.stopPropagation();">
            <span class="close-modal-btn" onclick="closePurchaseModal()" title="إغلاق">×</span>
            <h2 id="purchase-modal-title" style="color: var(--primary-color); margin-bottom: 1rem; line-height: 1.4;"></h2>
            <p style="font-size: 1.1rem; line-height: 1.7; color: var(--text-color); margin-bottom: 0.5rem;">
                للحصول على كلمة سر الكورس، قم بدفع <strong style="color: var(--secondary-color);">فودافون كاش</strong> على الرقم التالي:
            </p>
            <p class="payment-phone-number" style="font-size: 1.5rem; letter-spacing: 1px; margin-bottom: 1rem; user-select: all;">
                01067941806
            </p>
            <p style="font-size: 1.1rem; line-height: 1.7; color: var(--text-color); margin-bottom: 1.5rem;">
                بعد الدفع، يجب عليك إرسال سكرين شوت لإثبات عملية الدفع على نفس الرقم عبر واتساب.
            </p>
            <div class="purchase-modal-actions">
                <a href="tel:01067941806" class="btn-purchase-modal btn-call">اتصل الآن للدفع</a>
                <button class="btn-purchase-modal btn-enter-pass" id="purchase-modal-enter-pass-btn">أدخل كلمة السر</button>
                <button class="btn-purchase-modal btn-close" onclick="closePurchaseModal()">إغلاق</button>
            </div>
        </div>
    </div>
    <div id="password-modal" class="payment-modal-overlay" onclick="closePasswordModal()">
        <div class="payment-modal-content" onclick="event.stopPropagation();">
            <span class="close-modal-btn" onclick="closePasswordModal()" title="إغلاق">×</span>
            <h2 id="password-modal-title" data-lang-key="enter_password_prompt_title"></h2>
            <p id="password-modal-subtitle" data-lang-key="enter_password_prompt_subtitle"></p>
            <div class="password-input-container">
                <input type="password" id="password-input-field" placeholder="••••••••" autocomplete="off">
                <label for="password-input-field" data-lang-key="password_label"></label>
            </div>
            <button id="password-submit-btn" class="calculate-btn" onclick="submitPassword()">
                <span data-lang-key="submit_password"></span>
            </button>
        </div>
    </div>

    <div id="rating-modal-overlay" onclick="closeRatingModal()">
        <div class="rating-modal-content" onclick="event.stopPropagation();">
            <span class="close-modal-btn" onclick="closeRatingModal()" title="إغلاق">×</span>
            <h2 data-lang-key="rating_title">ما رأيك في المنصة؟</h2>
            <p data-lang-key="rating_subtitle">تقييمك يساعدنا على التحسين المستمر</p>
            <div class="star-rating" id="star-rating-container">
                <span class="star" data-value="1">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="5">★</span>
            </div>
            <button id="rating-submit-btn" class="calculate-btn" onclick="submitRating()" data-lang-key="rating_submit">إرسال التقييم</button>
        </div>
    </div>
    <script>
        let currentCourseUnlockData = { id: null, passwords: [], element: null };
        const contentData = {
            videos: {
                'e-commerce': [{id: 'hPLS6iZ8w2g'}, {id: '9d_EykIDid4'}, {id: '0fvYICr7m0M'}, {id: 'GFifm_fvkRk'}, {id: 't4qMMM3VuYM'}, {id: 'q2f_BVSVeHQ'}],
                'programming': [ {id: 'qaNZKH5NohQ'}, {id: 'eeRw__TlgmQ'}, {id: 'sRLK-0W0K2Y'}, {id: 'ow5hlYceRNI'}, {id: 'FMSOoWQR92I'}, {id: 'syIMz6BI1iQ'}, {id: 'j1-HJhZRzYo'} ],
                'montage': [{id: 'sm51PAGPPPM'}, {id: 'pC8n15SQPgs'}, {id: 'R3FrjHqAGoc'}, {id: 'Gy46eYYI5KA'}],
                'data-analytics': [{id: '-PDckX34514'}, {id: 'Mmz6CDLrbqU'}, {id: 'sn7rjRoIuAk'}],
                'ai': [{id: '35iAq6aoFMs'}, {id: '0I9qt2YQlvM'}, {id: 'u3DfqH-iZ5M'}],
                'podcasting': [{id: 'o7Fs1znEQZo'}, {id: 'dHjounyqtIA'}],
                'content-writing': [{id: 'Fs_ZWnjpdPM'}, {id: 'UHs1KWMkIDs'}, {id: 'PR1BCluaZVM'}],
                'cybersecurity': [{id: 'rsnleLdwbSw'}, {id: 'z3AWhxtZoEI'}, {id: 'R_buch3ojWY'}],
                'freelancing': [{id: '8ijsxKzgROM'}, {id: 'EtNiaeWr-B0'}, {id: 'PSYKSbpoDOo'}],
                'graphic-design': [{id: 'GWPq_DHpSW8'}, {id: 'D5TONJQVwu0'}, {id: 'TI23HUhO5OY'}]
            },
            courses: {
                'e-commerce': [{id: 'h0unhODkj40'}, {id: 'ICFXS5WIS3Y'}],
                'montage': [{id: 'qKtUjfolUOM'}, {id: '4XdTTX32Adg'}, {id: '8iGvUZKeLeU'}],
                'data-analytics': [{id: 'nXdkuxAj7tg'}, {id: 'z7nN0hZ_PtQ'}],
                'ai': [{id: 'oDmyhjwAYXk'}, {id: 'Rp5VnXnWMLk'}],
                'content-writing': [{id: '-PRi5kJ-JGM'}, {id: 'zs3PiS1t13g'}],
                'graphic-design': [{id: 'va-MZOPrJ0s'}, {id: '4IJPI0d7STI'}, {id: 'WlTsKiVwZAM'}]
            },
            paidCourses: [
                {
                    id: '07AC2Syf4Yg',
                    title: 'كورس كامل ++C',
                    price: '$6.00',
                    passwords: Array.from({length: 75}, (_, i) => `cpp_pass_${i.toString().padStart(3, '0')}`)
                },
                {
                    id: 'aLv2oD0q5XA',
                    title: 'كورس كامل تعلم فلاتر من الصفر',
                    price: '$5.50',
                    passwords: Array.from({length: 75}, (_, i) => `flutter_pass_${i.toString().padStart(3, '0')}`)
                },
                {
                    id: 'Z-5QVutAEW4',
                    title: 'كورس كامل تعلم CSS',
                    price: '$4.50',
                    passwords: Array.from({length: 75}, (_, i) => `css_pass_${i.toString().padStart(3, '0')}`)
                },
                {
                    id: 'cvNTgKw8VlY',
                    title: 'كورس كامل تعلم html',
                    price: '$5.00',
                    passwords: Array.from({length: 75}, (_, i) => `html_pass_${i.toString().padStart(3, '0')}`)
                },
                {
                    id: 'V8WPQSq6KSk',
                    title: 'كورس كامل تعلم التداول',
                    price: '$4.00',
                    passwords: Array.from({length: 75}, (_, i) => `trading_pass_${i.toString().padStart(3, '0')}`)
                },
                {
                    id: 'FIiGjKjfjUM',
                    title: 'كورس كامل تعلم المنتجات الرقمية',
                    price: '$6.00',
                    passwords: Array.from({length: 75}, (_, i) => `digital_pass_${i.toString().padStart(3, '0')}`)
                },
                {
                    id: 'ebdKbZrIej4',
                    title: 'كورس كامل تعلم التسويق',
                    price: '$3.50',
                    passwords: Array.from({length: 75}, (_, i) => `marketing_pass_${i.toString().padStart(3, '0')}`)
                },
                {
                    id: '-v_n8gJm8ps',
                    title: 'كورس تصميمات سوشيال ميديا',
                    price: '$5.50',
                    passwords: Array.from({length: 75}, (_, i) => `social_pass_${i.toString().padStart(3, '0')}`)
                }
            ],
            categoryImages: {
                 'e-commerce': 'https://i.postimg.cc/tCDy383Y/afb04de7b01f843c45abbc9ee08dc58e.jpg','programming': 'https://i.postimg.cc/k5rQJvzk/pngtree-website-programming-language-technology-digital-display-data-photo-image-13914360.jpg','montage': 'https://i.postimg.cc/sgQf4s3w/Da-Vinci-Resolve.jpg','data-analytics': 'https://i.postimg.cc/PJ7Jdxtv/Data-analytics.jpg','ai': 'https://i.postimg.cc/ZYsXJ3hD/d47ded45213710012f9af45e100599b4.jpg','podcasting': 'https://i.postimg.cc/GpNbBfW6/3ee0013e2c893850c0f26032678b8714.jpg','content-writing': 'https://i.postimg.cc/Mp9QLWBR/image.jpg','cybersecurity': 'https://i.postimg.cc/j2Rf9CMH/1316.jpg','freelancing': 'https://i.postimg.cc/bv2FYFp6/64f2f0d349b722684ff0271474cb5cfe6dd4fa2b.jpg','graphic-design': 'https://i.postimg.cc/5tYN41XZ/bd19730469cd909972bf71d5ffaf7c74.jpg'
            },
            categoryIcons: {
                 'e-commerce': '🛍️', 'programming': '💻', 'montage': '🎬', 'data-analytics': '📊', 'ai': '🤖','podcasting': '🎙️', 'content-writing': '✍️', 'cybersecurity': '🛡️', 'freelancing': '💼', 'graphic-design': '🎨'
            },
            articles: [
                 { 
                   id: "article-0", 
                   title: "ما هو العمل الحر؟ وكيف تبدأ رحلتك؟", 
                   excerpt: "تعرف على مفهوم العمل الحر، خطوات البدء، المهارات المطلوبة، وأفضل المنصات للعمل الحر.", 
                   content: `<h2>ما هو العمل الحر؟</h2>
<p>العمل الحر (Freelancing) هو نمط عمل يعتمد على تقديم خدمات مهنية أو فنية لعملاء مختلفين دون التزام بوظيفة دائمة لدى جهة واحدة. يعمل المستقل (Freelancer) بشكل مستقل، ويحدد هو ساعات عمله، أسعاره، ونوع المشاريع التي يرغب في تنفيذها.</p>

<h3>لماذا يتجه الناس للعمل الحر؟</h3>
<ul>
  <li><strong>المرونة:</strong> تحديد أوقات العمل ومكانه (من المنزل، المقهى، أو حتى أثناء السفر).</li>
  <li><strong>الدخل غير المحدود:</strong> كلما زادت مهاراتك وسمعتك، زاد دخلك دون سقف محدد.</li>
  <li><strong>الاستقلالية:</strong> أنت مدير نفسك، وتختار المشاريع التي تتوافق مع اهتماماتك.</li>
  <li><strong>التنويع:</strong> العمل مع عملاء من مختلف الثقافات والدول يوسع آفاقك المهنية.</li>
</ul>

<h3>كيف تبدأ رحلتك في العمل الحر؟</h3>
<ol>
  <li><strong>حدد مهارتك:</strong> اختر مجالًا تتقنه مثل التصميم، البرمجة، الكتابة، الترجمة، التسويق الرقمي، إلخ.</li>
  <li><strong>طور مهاراتك:</strong> استثمر في دورات تدريبية لتحسين مستواك ومواكبة أحدث الأدوات.</li>
  <li><strong>أنشئ ملفًا شخصيًا احترافيًا:</strong> صمم سيرة ذاتية (Portfolio) تعرض أعمالك السابقة.</li>
  <li><strong>انضم إلى منصات العمل الحر:</strong> مثل Upwork، Fiverr، مستقل، خمسات، وغيرها.</li>
  <li><strong>ابدأ بمشاريع صغيرة:</strong> لبناء سمعتك وجمع التقييمات الإيجابية.</li>
  <li><strong>تواصل باحترافية:</strong> كن واضحًا، سريع الرد، والتزم بالمواعيد النهائية.</li>
</ol>

<h3>أفضل المهارات المطلوبة في سوق العمل الحر</h3>
<ul>
  <li>البرمجة وتطوير المواقع (Web Development)</li>
  <li>التصميم الجرافيكي وتصميم واجهات المستخدم (UI/UX)</li>
  <li>الكتابة والتحرير والمحتوى (Content Writing)</li>
  <li>التسويق الرقمي وإدارة الحملات الإعلانية</li>
  <li>الترجمة (خاصة الإنجليزية والعربية)</li>
  <li>تحليل البيانات وعلم البيانات (Data Analytics)</li>
</ul>

<h3>نصائح للنجاح في العمل الحر</h3>
<ul>
  <li>لا تخفض أسعارك أكثر من اللازم في البداية — الجودة أهم من السعر.</li>
  <li>حافظ على علاقات جيدة مع عملائك — قد يعودون إليك بمشاريع جديدة.</li>
  <li>خصص وقتًا للتعلم المستمر.</li>
  <li>استخدم أدوات لإدارة الوقت والمشاريع مثل Trello أو Notion.</li>
  <li>افهم القوانين الضريبية المتعلقة بالدخل الحر في بلدك.</li>
</ul>

<h3>التحديات التي قد تواجهك</h3>
<p>قد تواجه في البداية صعوبة في العثور على عملاء، أو تأخر في الدفع، أو حتى المنافسة الشديدة. لكن مع الصبر، التطوير المستمر، والاحترافية، ستنجح وتبني مسارًا مهنيًا حرًا مزدهرًا.</p>

<p>العمل الحر ليس مجرد وظيفة، بل أسلوب حياة يمنحك الحرية، المسؤولية، والفرصة لتحقيق ذاتك مهنيًا وشخصيًا.</p>`,
                   img: "https://i.postimg.cc/bv2FYFp6/64f2f0d349b722684ff0271474cb5cfe6dd4fa2b.jpg" 
                 },
                 { id: "article-1", title: "دليل تحليل البيانات للمبتدئين", excerpt: "خطوة بخطوة لفهم تحليل البيانات...", content: `<h2>ما هو تحليل البيانات؟</h2><p>تحليل البيانات هو عملية فحص، تنظيف، تحويل، ونمذجة البيانات بهدف اكتشاف معلومات مفيدة، واستخلاص استنتاجات، ودعم اتخاذ القرارات.</p><h3>أهمية تحليل البيانات؟</h3><ul><li>يساعد الشركات على فهم سلوك العملاء.</li><li>يُحسّن كفاءة العمليات التشغيلية.</li><li>يدعم اتخاذ قرارات استراتيجية مبنية على أدلة.</li></ul><h3>خطوات تحليل البيانات</h3><ol><li>تحديد الهدف من التحليل.</li><li>جمع البيانات من مصادر موثوقة.</li><li>تنظيف البيانات من الأخطاء والقيم المفقودة.</li><li>تحليل البيانات باستخدام أدوات مثل Excel، Python، أو Tableau.</li><li>عرض النتائج عبر رسوم بيانية وتقارير واضحة.</li></ol><h3>أشهر الأدوات المستخدمة</h3><ul><li>Microsoft Excel</li><li>Python (مع مكتبات مثل Pandas وMatplotlib)</li><li>SQL لاستعلامات قواعد البيانات</li><li>Tableau وPower BI للتصور البياني</li></ul>`, img: "https://i.postimg.cc/PJ7Jdxtv/Data-analytics.jpg" },
                 { id: "article-2", title: "التجارة الإلكترونية: كيف تبدأ متجرك؟", excerpt: "من اختيار المنتج إلى التسويق...", content: `<h2>مقدمة إلى التجارة الإلكترونية</h2><p>التجارة الإلكترونية هي بيع وشراء السلع والخدمات عبر الإنترنت. أصبحت واحدة من أسرع القطاعات نموًا في العالم.</p><h3>خطوات إنشاء متجر إلكتروني ناجح</h3><ol><li><strong>اختر منتجًا أو خدمة:</strong> دراسة السوق، وتحليل المنافسين، وتحديد فئة مستهدفة.</li><li><strong>اختر منصة المتجر:</strong> مثل Shopify، WooCommerce، أو متاجر بلس.</li><li><strong>صمم المتجر:</strong> واجهة جذابة، سهلة التصفح، وسريعة التحميل.</li><li><strong>أضف طرق دفع موثوقة:</strong> مثل PayPal، فودافون كاش، أو البطاقات الائتمانية.</li><li><strong>اطلق حملات تسويقية:</strong> عبر السوشيال ميديا، الإعلانات الممولة، والبريد الإلكتروني.</li><li><strong>قدم خدمة عملاء ممتازة:</strong> للحفاظ على العملاء وتحويلهم إلى عملاء دائمين.</li></ol>`, img: "https://i.postimg.cc/tCDy383Y/afb04de7b01f843c45abbc9ee08dc58e.jpg" },
                 { id: "article-3", title: "مقدمة في الأمن السيبراني", excerpt: "ما هو الأمن السيبراني؟...", content: `<h2>ما هو الأمن السيبراني؟</h2><p>الأمن السيبراني هو حماية الأنظمة، الشبكات، والبرامج من الهجمات الرقمية التي تهدف إلى الوصول غير المصرح به، تغيير، أو تدمير المعلومات.</p><h3>أبرز التهديدات السيبرانية</h3><ul><li>البرمجيات الخبيثة (Malware)</li><li>التصيد الاحتيالي (Phishing)</li><li>هجمات حجب الخدمة (DDoS)</li><li>الهندسة الاجتماعية</li></ul><h3>كيف تحمي نفسك؟</h3><ol><li>استخدم كلمات مرور قوية ومختلفة لكل حساب.</li><li>فعّل المصادقة الثنائية (2FA).</li><li>حدّث أنظمتك وتطبيقاتك بانتظام.</li><li>لا تفتح روابط أو مرفقات من مصادر غير موثوقة.</li><li>استخدم برامج مضادة للفيروسات موثوقة.</li></ol>`, img: "https://i.postimg.cc/j2Rf9CMH/1316.jpg" },
                 { id: "article-4", title: "الذكاء الاصطناعي: من الألف إلى الياء", excerpt: "فهم أساسيات الذكاء الاصطناعي...", content: `<h2>ما هو الذكاء الاصطناعي؟</h2><p>الذكاء الاصطناعي (AI) هو فرع من علوم الحاسوب يهدف إلى إنشاء أنظمة قادرة على محاكاة الذكاء البشري، مثل التعلم، التفكير، واتخاذ القرارات.</p><h3>فروع الذكاء الاصطناعي</h3><ul><li>تعلم الآلة (Machine Learning)</li><li>الشبكات العصبية الاصطناعية</li><li>معالجة اللغة الطبيعية (NLP)</li><li>الرؤية الحاسوبية</li></ul><h3>تطبيقات الذكاء الاصطناعي</h3><p>تُستخدم تقنيات الذكاء الاصطناعي في السيارات ذاتية القيادة، المساعدات الصوتية (مثل Siri)، أنظمة التوصية (مثل Netflix)، والتشخيص الطبي.</p><h3>المستقبل</h3><p>يتوقع أن يصبح الذكاء الاصطناعي جزءًا لا يتجزأ من حياتنا اليومية، مما يخلق فرص عمل جديدة ويعيد تشكيل الصناعات التقليدية.</p>`, img: "https://i.postimg.cc/ZYsXJ3hD/d47ded45213710012f9af45e100599b4.jpg" }
            ]
        };
        const uiStrings = {
            ar: {
                app_name: "Mora Learning", home: "الرئيسية", articles: "المقالات", settings: "الإعدادات", support: "الدعم الفني", blog: "مدونة", profit_calculator: "حاسبة الأرباح", app_info: "معلومات التطبيق", privacy_policy: "سياسة الخصوصية", paid_courses: "كورسات مدفوعه", developed_by: "تم التطوير بواسطة", back_button: "الرجوع", welcome_main_title: "ابدأ رحلتك الرقمية مع Mora Learning", welcome_main_subtitle: "منصة التعلم الشاملة لعام 2025، حيث تبدأ رحلتك نحو التميز.", footer_rights: "جميع الحقوق محفوظة © Mora Learning 2025", 
                page_titles: {'home':'Mora Learning','articles':'المقالات','settings':'الإعدادات','support':'الدعم الفني','blog':'مدونة','profit_calculator':'حاسبة الأرباح','app_info':'معلومات التطبيق','privacy_policy':'سياسة الخصوصية','paid_courses':'كورسات مدفوعه','e-commerce':'التجارة الإلكترونية','programming':'البرمجة','montage':'المونتاج','data-analytics':'تحليل البيانات','ai':'الذكاء الاصطناعي','podcasting':'البودكاست','content-writing':'كتابة المحتوى','cybersecurity':'الأمن السيبراني','freelancing':'العمل الحر','graphic-design':'الجرافيك ديزاين', 'admin_panel': 'لوحة التحكم'}, 
                category_prefix: "تعلم", videos_title: "فيديوهات", courses_title: "كورسات", articles_title: "مقالات تعليمية متنوعة", settings_theme_title: "تغيير المظهر", settings_lang_title: "تغيير اللغة", settings_font_title: "تغيير حجم الخط", support_contact: "تواصل معانا", font_small: "صغير", font_medium: "متوسط", font_large: "كبير", buy_now: "اشترى الآن", enter_password: "ادخل كلمه السر", enter_password_prompt_title: "إدخال كلمة السر", enter_password_prompt_subtitle: "الرجاء إدخال كلمة السر لفتح الكورس", password_label: "كلمة السر", submit_password: "تأكيد", wrong_password: "كلمة السر غير صحيحة. حاول مرة أخرى.", password_expired: "كلمة السر هذه تم استخدامها من قبل. الرجاء طلب كلمة سر جديدة.", course_unlocked: "تم فتح الكورس! مشاهدة ممتعة.", price: "السعر", download: "تحميل", watch: "شاهد", app_info_title: "مهمتنا في Mora Learning", app_info_subtitle: "تمكين الأفراد من خلال التعلم المبتكر والمتاح للجميع", app_info_p1: "في Mora Learning، نؤمن أن التعليم هو حق للجميع، وليس امتيازًا لفئة مختارة. نسعى لتقديم محتوى عالي الجودة، محدث، وسهل الوصول عبر جميع الأجهزة.", app_info_p2: "نعتمد على فريق من الخبراء والمطورين لضمان تجربة تعلم سلسة، آمنة، ومحفزة للمستخدمين من مختلف الخلفيات والمستويات.", app_info_dev: "مطور التطبيق", app_info_version: "إصدار المنصة", app_info_build: "بناء رقم", app_info_env: "بيئة التعلم", app_info_env_val: "محسّنة للمكتب والجوال", 
                calculator_header_title: "حاسبة أرباح التجارة الإلكترونية", calculator_header_subtitle: "أدخل بياناتك المالية لحساب صافي الربح وهامش الربح بدقة.", calculator_revenue: "إجمالي الإيرادات", calculator_cogs: "تكلفة المنتجات المباعة (COGS)", calculator_marketing: "مصاريف التسويق والإعلانات", calculator_shipping: "تكاليف الشحن والتوصيل", calculator_other: "مصاريف أخرى (مثل الصيانة، الرواتب، إلخ)", calculator_calculate_btn: "احسب الأرباح", calculator_results_title: "تحليل الأرباح", calculator_total_costs: "إجمالي التكاليف", calculator_net_profit: "صافي الربح", calculator_profit_margin: "هامش الربح (%)", 
                privacy_title: "سياسة الخصوصية", privacy_intro: "نحن في Mora Learning نحترم خصوصيتك ونلتزم بحماية بياناتك الشخصية. تشرح هذه السياسة كيفية جمعنا واستخدامنا ومشاركة معلوماتك عند استخدامك لمنصتنا.", privacy_data_collection: "جمع البيانات", privacy_data_collection_text: "نقوم بجمع معلومات محدودة فقط عند الحاجة، مثل: اسم المستخدم، البريد الإلكتروني (اختياري)، تفضيلات اللغة والمظهر، وسجل تصفحك داخل التطبيق لأغراض تحسين الأداء. لا نقوم بجمع كلمات المرور أو معلومات الدفع — فجميع عمليات الدفع تتم خارج المنصة عبر وسائل اتصال مباشرة مع الداعم.", privacy_data_usage: "استخدام البيانات", privacy_data_usage_text: "تُستخدم البيانات المجمعة لتحسين تجربة المستخدم، تخصيص المحتوى، وتحليل أداء الميزات. لا نبيع بياناتك لأي طرف ثالث، ولا نستخدمها في الإعلانات المستهدفة.", privacy_security: "الأمان", privacy_security_text: "نطبق أفضل ممارسات الأمان لحماية بياناتك، بما في ذلك التشفير أثناء النقل، وتخزين البيانات المحلية فقط على جهازك (مثل الملاحظات في المدونة). لا يتم رفع أي بيانات شخصية إلى خوادمنا.", privacy_third_party: "روابط خارجية", privacy_third_party_text: "قد تحتوي المنصة على روابط لمنصات خارجية (مثل يوتيوب، إنستجرام، واتساب). نحن لسنا مسؤولين عن سياسات الخصوصية أو محتوى هذه المواقع. ننصحك بمراجعة سياسات الخصوصية الخاصة بها.", privacy_changes: "تعديلات على سياسة الخصوصية", privacy_changes_text: "قد نقوم بتحديث هذه السياسة من وقت لآخر. سيتم نشر أي تغييرات على هذه الصفحة مع تاريخ التحديث. نشجعك على مراجعتها دوريًا.", privacy_contact: "للاتصال بنا", privacy_contact_text: "إذا كانت لديك أي أسئلة أو مخاوف بشأن خصوصيتك، يمكنك التواصل معنا عبر البريد الإلكتروني: amrloutfy2006@gmail.com", privacy_dev_note: "تم تطوير هذه المنصة من قبل Amr Lotfy كمشروع تعليمي شخصي، ولا تُستخدم لأغراض تجارية مباشرة.",
                login_title: "تسجيل الدخول", login_name: "الاسم", login_age: "السن (للتأكيد)", login_pass: "كلمة المرور", login_btn: "دخول", login_switch: "ليس لديك حساب؟ <a>إنشاء حساب</a>",
                signup_title: "إنشاء حساب", signup_name: "الاسم", signup_age: "السن", signup_gender: "النوع", gender_male: "ذكر", gender_female: "أنثى", signup_pass: "كلمة المرور (8+ حروف وأرقام)", signup_btn: "إنشاء", signup_switch: "لديك حساب بالفعل؟ <a>تسجيل الدخول</a>",
                logout: "تسجيل الخروج", admin_panel: "لوحة التحكم", admin_visitors: "إجمالي الزوار", admin_users: "عدد المستخدمين", admin_platform: "إدارة المنصة", admin_add_video: "إضافة فيديو", admin_manage_sections: "إدارة الأقسام", admin_users_list: "قائمة المستخدمين",
                th_name: "الاسم", th_age: "السن", th_gender: "النوع", th_signup_date: "تاريخ/وقت التسجيل", th_status: "الحالة", th_ip: "IP", th_actions: "إجراءات", btn_delete: "حذف", btn_ban: "حظر الحساب", btn_unban: "فك حظر الحساب", status_online: "متصل", status_banned: "محظور",
                admin_ratings: "إجمالي التقييمات", admin_edit_stats: "تعديل الإحصائيات", admin_edit_visitors: "تعديل الزوار:", admin_edit_ratings: "تعديل التقييمات:", btn_save: "حفظ", admin_passwords: "إدارة كلمات المرور",
                rating_title: "ما رأيك في المنصة؟", rating_subtitle: "تقييمك يساعدنا على التحسين المستمر", rating_submit: "إرسال التقييم", rating_thanks: "شكراً لتقييمك!", btn_ban_ip: "حظر الجهاز (IP)"
            },
            en: { // Kept English for completeness, though UI is primarily Arabic based on context
                app_name: "Mora Learning", home: "Home", articles: "Articles", settings: "Settings", support: "Support", blog: "Blog", profit_calculator: "Profit Calculator", app_info: "App Information", privacy_policy: "Privacy Policy", paid_courses: "Paid Courses", developed_by: "Developed By", back_button: "Back", welcome_main_title: "Start Your Digital Journey...", welcome_main_subtitle: "The comprehensive learning platform...", footer_rights: "All Rights Reserved © Mora Learning 2025", 
                page_titles: {'home':'Mora Learning','articles':'Articles','settings':'Settings','support':'Support','blog':'Blog','profit_calculator':'Profit Calculator','app_info':'App Information','privacy_policy':'Privacy Policy','paid_courses':'Paid Courses','e-commerce':'E-commerce','programming':'Programming','montage':'Video Editing','data-analytics':'Data Analytics','ai':'Artificial Intelligence','podcasting':'Podcasting','content-writing':'Content Writing','cybersecurity':'Cybersecurity','freelancing':'Freelancing','graphic-design':'Graphic Design', 'admin_panel': 'Admin Panel'}, 
                category_prefix: "Learn", videos_title: "Videos", courses_title: "Courses", articles_title: "Diverse Educational Articles", settings_theme_title: "Change Theme", settings_lang_title: "Change Language", settings_font_title: "Change Font Size", support_contact: "Contact Us", font_small: "Small", font_medium: "Medium", font_large: "Large", buy_now: "Buy Now", enter_password: "Enter Password", enter_password_prompt_title: "Enter Password", enter_password_prompt_subtitle: "Please enter the password...", password_label: "Password", submit_password: "Submit", wrong_password: "Incorrect password...", password_expired: "This password has already been used...", course_unlocked: "Course unlocked! Enjoy.", price: "Price", download: "Download", watch: "Watch", app_info_title: "Our Mission...", app_info_subtitle: "Empowering individuals...", app_info_p1: "...", app_info_p2: "...", app_info_dev: "App Developer", app_info_version: "Platform Version", app_info_build: "Build Number", app_info_env: "Learning Environment", app_info_env_val: "Optimized for Desktop & Mobile", 
                calculator_header_title: "E-commerce Profit Calculator", calculator_header_subtitle: "Enter your financial data...", calculator_revenue: "Total Revenue", calculator_cogs: "COGS", calculator_marketing: "Marketing & Ad Spend", calculator_shipping: "Shipping Costs", calculator_other: "Other Expenses...", calculator_calculate_btn: "Calculate Profit", calculator_results_title: "Profit Analysis", calculator_total_costs: "Total Costs", calculator_net_profit: "Net Profit", calculator_profit_margin: "Profit Margin", 
                privacy_title: "Privacy Policy", privacy_intro: "...", privacy_data_collection: "Data Collection", privacy_data_collection_text: "...", privacy_data_usage: "Data Usage", privacy_data_usage_text: "...", privacy_security: "Security", privacy_security_text: "...", privacy_third_party: "External Links", privacy_third_party_text: "...", privacy_changes: "Changes to This Policy", privacy_changes_text: "...", privacy_contact: "Contact Us", privacy_contact_text: "...", privacy_dev_note: "...",
                login_title: "Login", login_name: "Name", login_age: "Age (for confirmation)", login_pass: "Password", login_btn: "Login", login_switch: "Don't have an account? <a>Sign Up</a>",
                signup_title: "Create Account", signup_name: "Name", signup_age: "Age", signup_gender: "Gender", gender_male: "Male", gender_female: "Female", signup_pass: "Password (8+ chars & numbers)", signup_btn: "Sign Up", signup_switch: "Already have an account? <a>Login</a>",
                logout: "Logout", admin_panel: "Admin Panel", admin_visitors: "Total Visitors", admin_users: "Total Users", admin_platform: "Platform Management", admin_add_video: "Add Video", admin_manage_sections: "Manage Sections", admin_users_list: "Users List",
                th_name: "Name", th_age: "Age", th_gender: "Gender", th_signup_date: "Signup Date/Time", th_status: "Status", th_ip: "IP", th_actions: "Actions", btn_delete: "Delete", btn_ban: "Ban Account", btn_unban: "Unban Account", status_online: "Online", status_banned: "Banned",
                admin_ratings: "Total Ratings", admin_edit_stats: "Edit Stats", admin_edit_visitors: "Edit Visitors:", admin_edit_ratings: "Edit Ratings:", btn_save: "Save", admin_passwords: "Password Management",
                rating_title: "Rate the Platform", rating_subtitle: "Your feedback helps us improve", rating_submit: "Submit Rating", rating_thanks: "Thank you for your rating!", btn_ban_ip: "Ban Device (IP)"
            }
        };
        let currentLang = 'ar';
        let historyStack = ['home'];
        const contentArea = document.getElementById("content-area");
        const pageTitle = document.getElementById("page-title");
        const backButton = document.getElementById("back-button");
        const welcomeMessage = document.getElementById("welcome-message");
        const sidebar = document.getElementById("sidebar");
        const sidebarMenu = document.getElementById("sidebar-menu");
        const bodyEl = document.body;
        const adminPanelLink = document.getElementById("admin-panel-link");
        const logoutLink = document.getElementById("logout-link");
        let vantaEffect = null; // To hold the 3D background instance
        let currentRating = 0; // To hold the selected star rating

        // --- NEW AUTH FUNCTIONS ---

        function checkBannedIP() {
            const mockIP = '127.0.0.1 (Mock)'; // Mock IP, as we can't get real IP in JS
            let bannedIPs = [];
            try {
                bannedIPs = JSON.parse(localStorage.getItem('bannedIPs')) || [];
            } catch (e) { console.error("Failed to parse banned IPs:", e); }
            
            if (bannedIPs.includes(mockIP)) {
                alert(currentLang === 'ar' ? 'جهازك محظور من استخدام التطبيق.' : 'Your device is banned from using this app.');
                return true; // Is banned
            }
            return false; // Is not banned
        }

        // MODIFIED: Show Login/Signup Fields
        function showLoginFields() {
            document.getElementById('auth-initial-buttons').style.display = 'none';
            document.getElementById('signup-fields').classList.remove('visible');
            document.getElementById('login-fields').classList.add('visible');
        }
        
        function showSignupFields() {
            document.getElementById('auth-initial-buttons').style.display = 'none';
            document.getElementById('login-fields').classList.remove('visible');
            document.getElementById('signup-fields').classList.add('visible');
        }

        function showInitialAuthButtons() {
            document.getElementById('login-fields').classList.remove('visible');
            document.getElementById('signup-fields').classList.remove('visible');
            document.getElementById('auth-initial-buttons').style.display = 'flex';
        }

        function getUsers() {
            try {
                const users = localStorage.getItem('moraUsers');
                return users ? JSON.parse(users) : [];
            } catch (e) {
                console.error("Failed to parse users:", e);
                return [];
            }
        }

        function saveUsers(users) {
            localStorage.setItem('moraUsers', JSON.stringify(users));
        }

        function handleSignup() {
            if (checkBannedIP()) return;

            const name = document.getElementById('signup-name').value.trim();
            const age = document.getElementById('signup-age').value;
            const gender = document.getElementById('signup-gender').value;
            const pass = document.getElementById('signup-pass').value;

            if (!name || !age || !pass) {
                alert(currentLang === 'ar' ? 'الرجاء ملء جميع الحقول.' : 'Please fill all fields.');
                return;
            }
            if (pass.length < 8 || !/\d/.test(pass)) {
                alert(currentLang === 'ar' ? 'كلمة المرور يجب أن تكون 8+ حروف وتحتوي على أرقام.' : 'Password must be 8+ characters and include a number.');
                return;
            }

            const users = getUsers();
            if (users.find(u => u.name.toLowerCase() === name.toLowerCase())) {
                alert(currentLang === 'ar' ? 'هذا الاسم مستخدم بالفعل. اختر اسم آخر.' : 'This name is already taken. Choose another.');
                return;
            }

            const newUser = {
                name: name,
                age: age,
                gender: gender,
                password: pass, // In a real app, HASH this password
                isBanned: false,
                isAdmin: false,
                signupDate: new Date().toISOString() // Store as ISO string
            };
            
            users.push(newUser);
            saveUsers(users);

            alert(currentLang === 'ar' ? 'تم إنشاء الحساب بنجاح! قم بتسجيل الدخول.' : 'Account created! Please log in.');
            
            // Pre-fill login form
            document.getElementById('login-name').value = name;
            // document.getElementById('login-age').value = age; // Age removed from login
            document.getElementById('login-pass').focus();
            
            showLoginFields(); // Show login fields directly
        }

        function handleLogin() {
            if (checkBannedIP()) return;

            const name = document.getElementById('login-name').value.trim();
            const pass = document.getElementById('login-pass').value;
            // const age = document.getElementById('login-age').value; // Age removed

            if (!name || !pass) {
                alert(currentLang === 'ar' ? 'الرجاء إدخال الاسم وكلمة المرور.' : 'Please enter name and password.');
                return;
            }

            // Admin check
            if (name === 'admen' && pass === 'Amr1221@gmail.com') {
                const adminSession = { name: 'admen', isAdmin: true };
                localStorage.setItem('loggedInUser', JSON.stringify(adminSession));
                initializeApp();
                return;
            }

            // Regular user check
            const users = getUsers();
            // Match only name and password
            const user = users.find(u => u.name.toLowerCase() === name.toLowerCase() && u.password === pass); 

            if (!user) {
                alert(currentLang === 'ar' ? 'الاسم أو كلمة المرور غير صحيحة.' : 'Incorrect name or password.');
                return;
            }

            if (user.isBanned) {
                alert(currentLang === 'ar' ? 'لقد تم حظرك من الدخول.' : 'You have been banned.');
                return;
            }

            // Age check removed
            // if (user.age != age) {
            //      alert(currentLang === 'ar' ? 'السن المدخل لا يطابق السن المسجل.' : 'The age entered does not match the registered age.');
            //     return;
            // }

            const userSession = { name: user.name, isAdmin: false };
            localStorage.setItem('loggedInUser', JSON.stringify(userSession));
            initializeApp();
        }

        function handleLogout() {
            localStorage.removeItem('loggedInUser');
            location.reload(); // Reloads, onload will show the login buttons
        }

        function initializeApp() {
            // Hide overlay
            const loginOverlay = document.getElementById('login-overlay');
            if (loginOverlay) loginOverlay.style.display = 'none';
            // Stop Vanta effect to save resources
            if (vantaEffect) vantaEffect.destroy();

            // Load user-specific UI
            const userSession = JSON.parse(localStorage.getItem('loggedInUser'));
            if (userSession) {
                logoutLink.style.display = 'list-item';
                if (userSession.isAdmin) {
                    adminPanelLink.style.display = 'list-item';
                } else {
                    // It's a regular user, check if they should be prompted for a rating
                    const hasRated = localStorage.getItem('userHasRated') === 'true';
                    if (!hasRated) {
                        setTimeout(showRatingModal, 20000); // Show after 20 seconds
                    }
                }
            }

            // Load preferences
            const savedTheme = localStorage.getItem('selectedTheme') || 'dark-theme';
            const savedFontSize = localStorage.getItem('selectedFontSize') || 'font-medium';
            bodyEl.className = `${savedTheme} ${savedFontSize}`;
            let baseSize = '16px';
            if (savedFontSize === 'font-small') baseSize = '14px';
            else if (savedFontSize === 'font-large') baseSize = '18px';
            document.documentElement.style.setProperty('--font-size-base', baseSize);

            currentLang = localStorage.getItem('selectedLanguage') || 'ar';
            historyStack = ['home'];
            updateLanguageUI();
        }
        
        // --- RATING MODAL FUNCTIONS ---
        
        function showRatingModal() {
            const modal = document.getElementById('rating-modal-overlay');
            if (modal) modal.style.display = 'flex';
            currentRating = 0; // Reset rating
            
            const stars = document.querySelectorAll('#star-rating-container .star');
            stars.forEach(star => {
                star.classList.remove('selected');
                star.onclick = () => setRating(star.getAttribute('data-value'));
                star.onmouseover = () => highlightStars(star.getAttribute('data-value'));
                star.onmouseleave = () => highlightStars(currentRating);
            });
        }
        
        function closeRatingModal() {
            const modal = document.getElementById('rating-modal-overlay');
            if (modal) modal.style.display = 'none';
        }

        function highlightStars(rating) {
            const stars = document.querySelectorAll('#star-rating-container .star');
            stars.forEach(star => {
                star.classList.toggle('selected', star.getAttribute('data-value') <= rating);
            });
        }
        
        function setRating(rating) {
            currentRating = parseInt(rating);
            highlightStars(currentRating);
        }
        
        function submitRating() {
            if (currentRating === 0) {
                alert(currentLang === 'ar' ? 'الرجاء اختيار تقييم أولاً' : 'Please select a rating first');
                return;
            }
            
            let ratings = [];
            try {
                ratings = JSON.parse(localStorage.getItem('moraRatings')) || [];
            } catch(e) { console.error("Failed to parse ratings:", e); }
            
            ratings.push({ rating: currentRating, date: new Date().toISOString() });
            localStorage.setItem('moraRatings', JSON.stringify(ratings));
            localStorage.setItem('userHasRated', 'true');
            
            closeRatingModal();
            alert(uiStrings[currentLang].rating_thanks || 'Thank you for your rating!');
        }

        // --- ADMIN PANEL FUNCTIONS ---

        function renderAdminPanel() {
            const langStrings = uiStrings[currentLang];
            const visitorCount = localStorage.getItem('visitorCount') || 0;
            const ratingOverride = localStorage.getItem('ratingCountOverride');
            const ratings = JSON.parse(localStorage.getItem('moraRatings')) || [];
            const displayRating = ratingOverride !== null ? ratingOverride : ratings.length;
            const users = getUsers();
            
            let html = `<div class="admin-stats-grid">
                            <div class="admin-stat-card">
                                <h3 data-lang-key="admin_visitors">${langStrings.admin_visitors}</h3>
                                <p>${visitorCount}</p>
                            </div>
                            <div class="admin-stat-card ratings">
                                <h3 data-lang-key="admin_ratings">${langStrings.admin_ratings}</h3>
                                <p>${displayRating}</p>
                            </div>
                            <div class="admin-stat-card">
                                <h3 data-lang-key="admin_users">${langStrings.admin_users}</h3>
                                <p>${users.length}</p>
                            </div>
                        </div>
                        
                        <div class="admin-section">
                            <h3 data-lang-key="admin_platform">${langStrings.admin_platform}</h3>
                            {/* Blue Admin Buttons */}
                            <button class="admin-btn btn-login" onclick="alert('Add Video: ${currentLang === 'ar' ? 'الوظيفة قيد التنفيذ' : 'Functionality in progress'}')" data-lang-key="admin_add_video">${langStrings.admin_add_video}</button>
                            <button class="admin-btn btn-login" onclick="alert('Manage Sections: ${currentLang === 'ar' ? 'الوظيفة قيد التنفيذ' : 'Functionality in progress'}')" data-lang-key="admin_manage_sections">${langStrings.admin_manage_sections}</button>
                        </div>
                        
                        <div class="admin-section">
                            <h3 data-lang-key="admin_edit_stats">${langStrings.admin_edit_stats}</h3>
                            <div class="admin-form-group">
                                <label for="admin-visitors-input" data-lang-key="admin_edit_visitors">${langStrings.admin_edit_visitors}</label>
                                <input type="number" id="admin-visitors-input" value="${visitorCount}">
                            </div>
                            <div class="admin-form-group">
                                <label for="admin-ratings-input" data-lang-key="admin_edit_ratings">${langStrings.admin_edit_ratings}</label>
                                <input type="number" id="admin-ratings-input" value="${displayRating}">
                            </div>
                             {/* Blue Save Button */}
                            <button class="admin-btn btn-login" onclick="saveAdminStats()" data-lang-key="btn_save">${langStrings.btn_save}</button>
                        </div>
                        
                        <div class="admin-section">
                            <h3 data-lang-key="admin_users_list">${langStrings.admin_users_list}</h3>
                            <table class="admin-user-table" id="user-list-table">
                                <thead>
                                    <tr>
                                        <th data-lang-key="th_name">${langStrings.th_name}</th>
                                        <th data-lang-key="th_age">${langStrings.th_age}</th>
                                        <th data-lang-key="th_gender">${langStrings.th_gender}</th>
                                        <th data-lang-key="th_signup_date">${langStrings.th_signup_date}</th>
                                        <th data-lang-key="th_status">${langStrings.th_status}</th>
                                        <th data-lang-key="th_ip">${langStrings.th_ip}</th>
                                        <th data-lang-key="th_actions">${langStrings.th_actions}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {/* User rows injected */}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="admin-section">
                            <h3 data-lang-key="admin_passwords">${langStrings.admin_passwords}</h3>
                            <div id="password-manager-container">
                                {/* Passwords injected */}
                            </div>
                        </div>`;
            return html;
        }
        
        function saveAdminStats() {
            const visitors = document.getElementById('admin-visitors-input').value;
            const ratings = document.getElementById('admin-ratings-input').value;
            
            localStorage.setItem('visitorCount', visitors);
            localStorage.setItem('ratingCountOverride', ratings);
            
            alert(currentLang === 'ar' ? 'تم حفظ الإحصائيات!' : 'Stats saved!');
            _renderSection('admin_panel', true); // Re-render admin panel
        }

        function renderUserTable() {
            const tableBody = document.querySelector("#user-list-table tbody");
            if (!tableBody) return;

            const users = getUsers();
            const langStrings = uiStrings[currentLang];
            tableBody.innerHTML = ''; // Clear existing rows

            users.forEach(user => {
                // MODIFIED: Format date and time
                const signupDateTime = new Date(user.signupDate).toLocaleString(currentLang === 'ar' ? 'ar-EG' : 'en-US', { 
                    day: '2-digit', month: '2-digit', year: 'numeric', 
                    hour: '2-digit', minute: '2-digit', hour12: true 
                });
                const gender = user.gender === 'male' ? langStrings.gender_male : langStrings.gender_female;
                const status = user.isBanned ? `<span style="color: var(--danger-color);">${langStrings.status_banned}</span>` : `<span style="color: var(--success-color);">${langStrings.status_online}</span>`;
                const banButton = user.isBanned 
                    ? `<button class="admin-btn btn-login" onclick="toggleBanUser('${user.name}', false)" data-lang-key="btn_unban">${langStrings.btn_unban}</button>`
                    : `<button class="admin-btn btn-ban" onclick="toggleBanUser('${user.name}', true)" data-lang-key="btn_ban">${langStrings.btn_ban}</button>`;

                const row = `<tr>
                                <td>${user.name}</td>
                                <td>${user.age}</td>
                                <td>${gender}</td>
                                <td>${signupDateTime}</td> {/* Display date and time */}
                                <td>${status}</td>
                                <td>127.0.0.1 (Mock)</td>
                                <td>
                                    ${banButton}
                                    <button class="admin-btn btn-ban" onclick="banUserIP('${user.name}')" data-lang-key="btn_ban_ip">${langStrings.btn_ban_ip}</button>
                                    <button class="admin-btn btn-delete" onclick="deleteUser('${user.name}')" data-lang-key="btn_delete">${langStrings.btn_delete}</button>
                                </td>
                            </tr>`;
                tableBody.innerHTML += row;
            });
        }
        
        function toggleBanUser(name, shouldBan) {
            const users = getUsers();
            const userIndex = users.findIndex(u => u.name === name);
            if (userIndex > -1) {
                users[userIndex].isBanned = shouldBan;
                saveUsers(users);
                renderUserTable();
            }
        }
        
        function banUserIP(name) {
            const mockIP = '127.0.0.1 (Mock)'; // This is all we have
            const confirmMsg = currentLang === 'ar' ? `هل أنت متأكد من حظر جهاز (IP: ${mockIP}) الخاص بالمستخدم ${name}؟` : `Are you sure you want to ban the device (IP: ${mockIP}) for user ${name}?`;
            if (!confirm(confirmMsg)) return;
            
            let bannedIPs = [];
            try {
                bannedIPs = JSON.parse(localStorage.getItem('bannedIPs')) || [];
            } catch(e) { console.error("Failed to parse banned IPs:", e); }
            
            if (!bannedIPs.includes(mockIP)) {
                bannedIPs.push(mockIP);
                localStorage.setItem('bannedIPs', JSON.stringify(bannedIPs));
            }
            alert(currentLang === 'ar' ? 'تم حظر الجهاز (IP)!' : 'Device (IP) banned!');
        }
        
        function deleteUser(name) {
            const confirmMsg = currentLang === 'ar' ? `هل أنت متأكد من حذف ${name}؟ لا يمكن التراجع عن هذا.` : `Are you sure you want to delete ${name}? This cannot be undone.`;
            if (confirm(confirmMsg)) {
                let users = getUsers();
                users = users.filter(u => u.name !== name);
                saveUsers(users);
                renderUserTable();
            }
        }
        
        function renderPasswordManager() {
            const container = document.getElementById('password-manager-container');
            if (!container) return;
            
            container.innerHTML = '';
            const langStrings = uiStrings[currentLang];
            
            contentData.paidCourses.forEach(course => {
                const courseId = course.id;
                let activePasswords = course.passwords;
                
                try {
                    const storedPasswords = localStorage.getItem('course_passwords_' + courseId);
                    if (storedPasswords) {
                        activePasswords = JSON.parse(storedPasswords);
                    }
                } catch(e) { console.error("Failed to parse stored passwords:", e); }
                
                const itemHTML = `
                    <div class="password-manager-item">
                        <h4>${course.title}</h4>
                        <textarea id="pass-edit-${courseId}" rows="5">${activePasswords.join('\n')}</textarea>
                        {/* Blue Save Button */}
                        <button class="admin-btn btn-login" style="margin-top: 0.75rem;" onclick="saveCoursePasswords('${courseId}')" data-lang-key="btn_save">
                            ${langStrings.btn_save}
                        </button>
                    </div>
                `;
                container.innerHTML += itemHTML;
            });
        }
        
        function saveCoursePasswords(courseId) {
            const textarea = document.getElementById('pass-edit-' + courseId);
            if (!textarea) return;
            
            const newPasswords = textarea.value.split('\n').map(p => p.trim()).filter(p => p !== '');
            localStorage.setItem('course_passwords_' + courseId, JSON.stringify(newPasswords));
            
            alert(currentLang === 'ar' ? 'تم حفظ كلمات المرور!' : 'Passwords saved!');
        }


        // --- EXISTING FUNCTIONS (MODIFIED) ---

        function updateLanguageUI() {
            const langStrings = uiStrings[currentLang];
            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                if (langStrings[key]) {
                    // Handle links with nested <a> tags like the auth switch
                    if (el.children.length > 0 && el.children[0].tagName === 'A') {
                        const linkText = el.children[0].innerHTML;
                        const onclickAction = el.children[0].getAttribute('onclick'); // Get the action
                        el.innerHTML = langStrings[key].replace('<a>', `<a onclick="${onclickAction}">`).replace('</a>', `${linkText}</a>`); // Re-apply action
                    } else {
                        el.textContent = langStrings[key];
                    }
                }
            });
            const passInput = document.getElementById('password-input-field');
            if (passInput) passInput.placeholder = "••••••••";
            const blogTextarea = document.getElementById('blogTextarea');
            if (blogTextarea) blogTextarea.placeholder = currentLang === 'ar' ? 'اكتب ملاحظاتك وأفكارك هنا...' : 'Write your notes and ideas here...';
            
            // Update auth form placeholders
            const loginName = document.getElementById('login-name');
            if (loginName) loginName.placeholder = currentLang === 'ar' ? '...اكتب اسمك' : '...Enter your name';
            // const loginAge = document.getElementById('login-age'); // Removed
            // if (loginAge) loginAge.placeholder = currentLang === 'ar' ? '...اكتب سنك' : '...Enter your age';
            const loginPass = document.getElementById('login-pass');
            if (loginPass) loginPass.placeholder = currentLang === 'ar' ? '...اكتب كلمة المرور' : '...Enter your password';
            const signupName = document.getElementById('signup-name');
            if (signupName) signupName.placeholder = currentLang === 'ar' ? '...اختر اسم فريد' : '...Choose a unique name';
            const signupAge = document.getElementById('signup-age');
            if (signupAge) signupAge.placeholder = currentLang === 'ar' ? '...اكتب سنك' : '...Enter your age';
            const signupPass = document.getElementById('signup-pass');
            if (signupPass) signupPass.placeholder = currentLang === 'ar' ? '8+ حروف وأرقام' : '8+ chars & numbers';


            // Re-render current section to update any dynamic text
            _renderSection(historyStack[historyStack.length - 1], true);
        }

        function _getPageTitle(section) {
            const langStrings = uiStrings[currentLang];
            if (langStrings.page_titles[section]) return langStrings.page_titles[section];
            if (section.startsWith('article-')) {
                const article = contentData.articles.find(a => a.id === section);
                return article ? article.title : 'Article';
            }
            return section.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function _updateActiveSidebarLink(section) {
            sidebarMenu.querySelectorAll('a').forEach(link => {
                const onclickAttr = link.getAttribute('onclick');
                if (!onclickAttr) {
                    link.classList.remove('active');
                    return;
                }
                const match = onclickAttr.match(/'([^']+)'/);
                let linkSection = match ? match[1] : null;
                let isActive = linkSection === section;
                
                if (!isActive && section.startsWith('article-') && linkSection === 'articles') isActive = true;
                if (linkSection === 'home' && section !== 'home' && !section.startsWith('article-')) {
                     isActive = false; 
                }
                if(linkSection === section) isActive = true;


                link.classList.toggle('active', isActive);
            });
        }

        function showSection(section, isLanguageUpdate = false) {
            const currentSection = historyStack[historyStack.length - 1];
            if (!isLanguageUpdate && currentSection !== section) {
                if (historyStack.length > 1 && historyStack[historyStack.length - 2] === section) {
                    historyStack.pop();
                } else if (currentSection !== section) {
                    historyStack.push(section);
                }
            } else if (isLanguageUpdate && !historyStack.includes(section)) {
                console.warn(`Section "${section}" invalid, defaulting home.`);
                historyStack = ['home'];
                section = 'home';
            }
            if (window.innerWidth <= 768) sidebar.classList.remove("open");
            _renderSection(section, isLanguageUpdate);
        }

        function _renderSection(section, isLanguageUpdate = false) {
            _updateActiveSidebarLink(section);
            backButton.style.display = (historyStack.length > 1) ? "block" : "none";
            welcomeMessage.style.display = (section === 'home') ? "block" : "none";
            pageTitle.textContent = _getPageTitle(section);
            const fadeOutDuration = 300;
            if (contentArea.innerHTML.trim() !== '' && !isLanguageUpdate) {
                contentArea.classList.add('fadeOut');
            } else {
                contentArea.innerHTML = '';
                contentArea.classList.remove('fadeInUp', 'fadeOut');
            }
            setTimeout(() => {
                contentArea.innerHTML = '';
                contentArea.classList.remove('fadeOut');
                let contentHTML = "";
                const langStrings = uiStrings[currentLang];
                if (section.startsWith('article-')) {
                    const article = contentData.articles.find(a => a.id === section);
                    contentHTML = article ? `<div class="page-content-wrapper">${article.content}</div>` : `<div class="page-content-wrapper"><p>Article not found.</p></div>`;
                } else if (contentData.videos[section] || contentData.courses[section]) {
                    const youtubeLink = (id) => `https://www.youtube.com/watch?v=${id}`;
                    let vids = contentData.videos[section]?.map((v, i) =>
                        `<div class="video-item"><div class="video-thumbnail" onclick="playVideo(this.closest('.video-item'), '${v.id}')"><img src="https://img.youtube.com/vi/${v.id}/hqdefault.jpg" loading="lazy" alt="Vid ${i+1}"><div class="play-icon">▶</div></div><div class="video-actions"><button class="video-btn watch-btn" onclick="playVideo(this.closest('.video-item'), '${v.id}')">${langStrings.watch}</button><a href="${youtubeLink(v.id)}" target="_blank" rel="noopener noreferrer" class="video-btn download-btn">${langStrings.download}</a></div></div>`
                    ).join('') || '';
                    let crss = contentData.courses[section]?.map((c, i) =>
                          `<div class="video-item"><div class="video-thumbnail" onclick="playVideo(this.closest('.video-item'), '${c.id}')"><img src="https://img.youtube.com/vi/${c.id}/hqdefault.jpg" loading="lazy" alt="Course ${i+1}"><div class="play-icon">▶</div></div><div class="video-actions"><button class="video-btn watch-btn" onclick="playVideo(this.closest('.video-item'), '${c.id}')">${langStrings.watch}</button><a href="${youtubeLink(c.id)}" target="_blank" rel="noopener noreferrer" class="video-btn download-btn">${langStrings.download}</a></div></div>`
                    ).join('');
                    contentHTML = `<div class="page-content-wrapper">${vids ? `<h2 class="section-title">${langStrings.videos_title} ${_getPageTitle(section)}</h2><div class="video-list">${vids}</div>` : ''}${crss ? `<h2 class="section-title">${langStrings.courses_title} ${_getPageTitle(section)}</h2><div class="video-list">${crss}</div>` : ''}</div>`;
                    if (!vids && !crss) contentHTML = `<div class="page-content-wrapper"><p>No content.</p></div>`;
                } else {
                    switch (section) {
                        case 'home':
                            contentHTML = `<div class="articles-container">` + Object.keys(contentData.categoryImages).map((cat, i) => {
                                const title = langStrings.page_titles[cat] || cat;
                                const free = currentLang === 'ar' ? '(مجاناً)' : '(Free)';
                                const emoji = contentData.categoryIcons[cat] || '';
                                return `<div class="category-card" onclick="showSection('${cat}')"><img src="${contentData.categoryImages[cat]}" alt="${title}" loading="lazy"><div class="category-text-overlay"><h2><span class="category-emoji">${emoji}</span><span class="category-title">${langStrings.category_prefix} ${title}</span><span class="category-free">${free}</span></h2></div></div>`;
                            }).join('') + `</div>`;
                            break;
                        case 'paid_courses':
                            const buyNowText = langStrings.buy_now || (currentLang === 'ar' ? 'اشترى الآن' : 'Buy Now');
                            contentHTML = `<div class="page-content-wrapper"><div class="video-list">` +
                            contentData.paidCourses.map((course, i) =>
                                `<div class="paid-course-card-new">
                                    <div class="paid-thumbnail-new">
                                        <span class="lock-icon-new">🔒</span>
                                    </div>
                                    <div class="paid-content-new">
                                        <h3 class="course-title-new">${course.title}</h3>
                                        <div class="course-price-new">${langStrings.price}: ${course.price}</div>
                                        <button class="buy-now-btn-new" onclick="showPurchaseModal(this, '${course.id}', \`${escape(course.title)}\`)">
                                            ${buyNowText}
                                        </button>
                                    </div>
                                </div>`
                            ).join('') + `</div></div>`;
                            break;
                        case 'articles':
                            contentHTML = `<div class="page-content-wrapper"><h2 class="section-title">${langStrings.articles_title}</h2><div class="articles-container">` + contentData.articles.map((article, i) =>
                                `<div class="article-card" onclick="showSection('${article.id}')"><img src="${article.img}" alt="${article.title}" class="article-img" loading="lazy"><div class="article-content"><div><div class="article-title">${article.title}</div><div class="article-excerpt">${article.excerpt}</div></div><div class="read-more">${currentLang === 'ar' ? 'اقرأ المزيد →' : 'Read More →'}</div></div></div>`
                            ).join('') + `</div></div>`;
                            break;
                        case 'blog':
                            const savedNote = localStorage.getItem('userBlogNote') || '';
                            contentHTML = `<div class="page-content-wrapper"><textarea class="blog-textarea" id="blogTextarea" placeholder="${currentLang === 'ar' ? 'اكتب ملاحظاتك...' : 'Write your notes...'}">${savedNote}</textarea><button class="blog-save-btn" onclick="saveBlog()">${currentLang === 'ar' ? 'حفظ' : 'Save'}</button></div>`;
                            break;
                        case 'settings':
                            contentHTML = `<div class="page-content-wrapper"><div class="setting-item"><h3 data-lang-key="settings_theme_title">${langStrings.settings_theme_title}</h3><div class="theme-options"><div class="theme-option" data-theme="dark-theme" onclick="selectTheme(this)">${currentLang==='ar'?'داكن':'Dark'}</div><div class="theme-option" data-theme="light-theme" onclick="selectTheme(this)">${currentLang==='ar'?'فاتح':'Light'}</div><div class="theme-option" data-theme="pink-theme" onclick="selectTheme(this)">${currentLang==='ar'?'فوشيا':'Pink'}</div><div class="theme-option" data-theme="green-theme" onclick="selectTheme(this)">${currentLang==='ar'?'أخضر':'Green'}</div></div></div><div class="setting-item"><h3 data-lang-key="settings_lang_title">${langStrings.settings_lang_title}</h3><div class="language-options"><div class="language-option" data-lang="ar" onclick="selectLanguage(this)">العربية</div><div class="language-option" data-lang="en" onclick="selectLanguage(this)">English</div></div></div><div class="setting-item"><h3 data-lang-key="settings_font_title">${langStrings.settings_font_title}</h3><div class="font-size-options"><div class="font-size-option" data-font-size="font-small" onclick="selectFontSize(this)">${langStrings.font_small}</div><div class="font-size-option" data-font-size="font-medium" onclick="selectFontSize(this)">${langStrings.font_medium}</div><div class="font-size-option" data-font-size="font-large" onclick="selectFontSize(this)">${langStrings.font_large}</div></div></div></div>`;
                            queueMicrotask(loadSettingsUI);
                            break;
                        case 'support':
                            contentHTML = `<div class="page-content-wrapper"><div class="support-intro"><h2>${currentLang === 'ar' ? 'نحن هنا من أجلك!' : 'We Are Here For You!'}</h2><p>${currentLang === 'ar' ? 'في Mora Learning، نلتزم بتقديم دعم فني سريع وفعال لجميع المستخدمين. لا تتردد في التواصل معنا عبر أي من القنوات التالية:' : 'At Mora Learning...'}</p></div><div class="contact-methods"><a href="tel:+201067941806" class="contact-link"><div class="contact-item"><svg class="contact-icon" viewBox="0 0 24 24"><path d="M6.62,10.79C8.06,13.62 10.38,15.94 13.21,17.38L15.41,15.18C15.69,14.9 16.08,14.82 16.43,14.93C17.55,15.3 18.75,15.5 20,15.5A1,1 0 0,1 21,16.5V20A1,1 0 0,1 20,21A17,17 0 0,1 3,4A1,1 0 0,1 4,3H7.5A1,1 0 0,1 8.5,4C8.5,5.25 8.7,6.45 9.07,7.57C9.18,7.92 9.1,8.31 8.82,8.59L6.62,10.79Z" fill="currentColor"></path></svg><div class="contact-text">${langStrings.support_contact} (Phone)</div></div></a><a href="https://www.instagram.com/eltopamr55?igsh=MWJ2MzJqaXBlZzRlaQ==" class="contact-link" target="_blank" rel="noopener noreferrer"><div class="contact-item"><svg class="contact-icon" viewBox="0 0 24 24"><path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.2,5.2 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.2,5.2 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z" fill="currentColor"></path></svg><div class="contact-text">${langStrings.support_contact} (Instagram)</div></div></a><a href="mailto:amrloutfy2006@gmail.com" class="contact-link"><div class="contact-item"><svg class="contact-icon" viewBox="0 0 24 24"><path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z" fill="currentColor"></path></svg><div class="contact-text">${langStrings.support_contact} (Email)</div></div></a><a href="https://wa.me/201067941806" class="contact-link" target="_blank" rel="noopener noreferrer"><div class="contact-item"><svg class="contact-icon" viewBox="0 0 24 24"><path d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.59 15.35 3.45 16.86L2.05 22L7.31 20.6C8.75 21.39 10.36 21.82 12.04 21.82C17.5 21.82 21.95 17.37 21.95 11.91C21.95 6.45 17.5 2 12.04 2M12.04 3.67C16.56 3.67 20.28 7.39 20.28 11.91C20.28 16.43 16.56 20.15 12.04 20.15C10.49 20.15 9 19.74 7.72 19L7.33 18.78L4.44 19.58L5.26 16.75L5.03 16.36C4.26 15 3.8 13.47 3.8 11.91C3.8 7.39 7.52 3.67 12.04 3.67M9.21 7.63C9.03 7.63 8.85 7.64 8.69 7.67C8.53 7.7 8.24 7.8 7.92 8.12C7.6 8.44 6.96 9.04 6.96 10.2C6.96 11.36 7.95 12.48 8.11 12.67C8.27 12.86 9.53 14.93 11.53 15.73C13.21 16.42 13.79 16.34 14.23 16.29C14.72 16.23 15.78 15.66 15.98 15.06C16.18 14.46 16.18 14.01 16.1 13.9C16.02 13.79 15.86 13.72 15.61 13.6C15.36 13.48 14.1 12.91 13.88 12.83C13.66 12.75 13.5 12.71 13.34 12.93C13.18 12.15 12.72 13.71 12.58 13.87C12.44 14.03 12.3 14.04 12.05 13.92C11.8 13.8 10.79 13.46 9.62 12.44C8.71 11.63 8.12 10.66 7.97 10.42C7.82 10.18 7.95 10.06 8.08 9.93C8.2 9.81 8.35 9.63 8.48 9.49C8.61 9.35 8.66 9.26 8.75 9.09C8.84 8.92 8.79 8.78 8.73 8.66C8.67 8.54 8.16 7.27 7.95 7.05C7.74 6.83 7.54 6.84 7.38 6.84C7.22 6.84 7.06 6.84 6.91 6.84H6.75L6.46 6.86C6.17 6.89 5.92 6.98 5.71 7.23C5.5 7.48 5.04 7.97 5.04 9.1C5.04 10.23 5.73 11.3 5.89 11.49C6.05 11.68 7.27 13.7 9.24 14.5C10.92 15.2 11.5 15.12 11.94 15.07C12.43 15.01 13.49 14.44 13.69 13.84C13.89 13.24 13.89 12.79 13.81 12.68C13.73 12.57 13.57 12.5 13.32 12.38C13.07 12.26 11.81 11.69 11.59 11.61C11.37 11.53 11.21 11.49 11.05 11.71C10.89 11.93 10.43 12.49 10.29 12.65C10.15 12.81 10.01 12.82 9.76 12.7C9.51 12.58 8.5 12.24 7.33 11.22C6.42 10.41 5.83 9.44 5.68 9.2C5.53 8.96 5.66 8.84 5.79 8.71C5.91 8.59 6.06 8.41 6.19 8.27C6.32 8.13 6.37 8.04 6.46 7.87C6.55 7.7 6.5 7.56 6.44 7.44C6.38 7.32 5.87 6.05 5.66 5.83C5.45 5.61 5.25 5.62 5.09 5.62Z" fill="currentColor"></path></svg><div class="contact-text">${langStrings.support_contact} (WhatsApp)</div></div></a></div></div>`;
                            break;
                        case 'privacy_policy':
                            contentHTML = `<div class="page-content-wrapper"><h2 data-lang-key="privacy_title">${langStrings.privacy_title}</h2><p>${langStrings.privacy_intro}</p><h3>${langStrings.privacy_data_collection}</h3><p>${langStrings.privacy_data_collection_text}</p><h3>${langStrings.privacy_data_usage}</h3><p>${langStrings.privacy_data_usage_text}</p><h3>${langStrings.privacy_security}</h3><p>${langStrings.privacy_security_text}</p><h3>${langStrings.privacy_third_party}</h3><p>${langStrings.privacy_third_party_text}</p><h3>${langStrings.privacy_changes}</h3><p>${langStrings.privacy_changes_text}</p><h3>${langStrings.privacy_contact}</h3><p>${langStrings.privacy_contact_text}</p><p style="color:var(--text-muted);font-style:italic;margin-top:1.5rem;">${langStrings.privacy_dev_note}</p></div>`;
                            break;
                        case 'app_info':
                            contentHTML = `<div class="page-content-wrapper" style="display:flex;flex-direction:column;align-items:center;"><img src="https://i.postimg.cc/Nf0Sr2zg/file-00000000d52862468b52a49178cf0009.png" alt="Mora Learning Logo" class="app-info-logo"><h2 data-lang-key="app_info_title">${langStrings.app_info_title}</h2><h3 data-lang-key="app_info_subtitle" style="color:var(--text-muted);font-weight:normal;margin-bottom:1.5rem;text-align:center;">${langStrings.app_info_subtitle}</h3><p data-lang-key="app_info_p1">${langStrings.app_info_p1}</p><p data-lang-key="app_info_p2">${langStrings.app_info_p2}</p><div class="app-info-details"><div class="cinematic-info-item"><span class="info-label" data-lang-key="app_info_dev">${langStrings.app_info_dev}</span><span class="info-value developer">Amr Lotfy</span></div><div class="cinematic-info-item"><span class="info-label" data-lang-key="app_info_version">${langStrings.app_info_version}</span><span class="info-value">2025.1.1</span></div><div class="cinematic-info-item"><span class="info-label" data-lang-key="app_info_build">${langStrings.app_info_build}</span><span class="info-value">ML-20251019-1325</span></div><div class="cinematic-info-item"><span class="info-label" data-lang-key="app_info_env">${langStrings.app_info_env}</span><span class="info-value" style="color:var(--success-color);">${langStrings.app_info_env_val}</span></div></div></div>`;
                            break;
                        case 'profit_calculator':
                            contentHTML = `<div class="profit-calculator-container"><div class="calculator-header"><h2 data-lang-key="calculator_header_title">${langStrings.calculator_header_title}</h2><p data-lang-key="calculator_header_subtitle">${langStrings.calculator_header_subtitle}</p></div><div class="calculator-form-grid"><div class="form-group"><input type="number" id="revenue" placeholder=" " autocomplete="off"><label for="revenue" data-lang-key="calculator_revenue">${langStrings.calculator_revenue}</label></div><div class="form-group"><input type="number" id="cogs" placeholder=" " autocomplete="off"><label for="cogs" data-lang-key="calculator_cogs">${langStrings.calculator_cogs}</label></div><div class="form-group"><input type="number" id="marketing" placeholder=" " autocomplete="off"><label for="marketing" data-lang-key="calculator_marketing">${langStrings.calculator_marketing}</label></div><div class="form-group"><input type="number" id="shipping" placeholder=" " autocomplete="off"><label for="shipping" data-lang-key="calculator_shipping">${langStrings.calculator_shipping}</label></div><div class="form-group"><input type="number" id="otherCosts" placeholder=" " autocomplete="off"><label for="otherCosts" data-lang-key="calculator_other">${langStrings.calculator_other}</label></div></div><div class="calculator-actions"><button class="calculate-btn" onclick="calculateProfit()" data-lang-key="calculator_calculate_btn">${langStrings.calculator_calculate_btn}</button></div><div class="calculator-results-container" id="results-container"><h3 style="text-align:center;margin-bottom:1.5rem;color:var(--primary-color);">${langStrings.calculator_results_title}</h3><div class="results-grid" id="results-content"></div></div></div>`;
                            break;
                        case 'admin_panel':
                            const userSession = JSON.parse(localStorage.getItem('loggedInUser'));
                            if (userSession && userSession.isAdmin) {
                                contentHTML = renderAdminPanel();
                                queueMicrotask(() => {
                                    renderUserTable();
                                    renderPasswordManager();
                                });
                            } else {
                                contentHTML = `<div class="page-content-wrapper"><p>Access Denied.</p></div>`;
                                historyStack.pop(); // Remove admin panel from history
                                queueMicrotask(() => showSection('home')); // Redirect
                            }
                            break;
                        default:
                            contentHTML = `<div class="page-content-wrapper"><p>Content loading or section not found.</p></div>`;
                    }
                }
                contentArea.innerHTML = contentHTML;
                const animatedElements = contentArea.querySelectorAll('.page-content-wrapper > *, .articles-container > *, .video-list > *, .admin-stats-grid > *, .admin-section');
                animatedElements.forEach((el, index) => {
                    el.classList.remove('animated', 'fadeInUp', 'fadeOut');
                    void el.offsetWidth;
                    el.classList.add('animated', 'fadeInUp');
                    el.style.animationDelay = `${0.1 + index * 0.05}s`;
                });
            }, isLanguageUpdate ? 0 : fadeOutDuration);
        }

        // --- ORIGINAL FUNCTIONS (UNMODIFIED or MINOR TWEAKS) ---

        function calculateProfit() {
            const langStrings = uiStrings[currentLang];
            const getVal = (id) => parseFloat(document.getElementById(id)?.value) || 0;
            const revenue = getVal('revenue'), cogs = getVal('cogs'), marketing = getVal('marketing'), shipping = getVal('shipping'), otherCosts = getVal('otherCosts');
            const totalCosts = cogs + marketing + shipping + otherCosts;
            const netProfit = revenue - totalCosts;
            const profitMargin = revenue !== 0 ? (netProfit / revenue) * 100 : 0;
            const resultsContainer = document.getElementById('results-container');
            const resultsContent = document.getElementById('results-content');
            if (!resultsContainer || !resultsContent) return;
            const profitClass = netProfit >= 0 ? 'profit' : 'loss';
            resultsContent.innerHTML = '';
            const resultsData = [
                { labelKey: 'calculator_total_costs', value: totalCosts.toFixed(2), class: '' },
                { labelKey: 'calculator_net_profit', value: netProfit.toFixed(2), class: profitClass },
                { labelKey: 'calculator_profit_margin', value: `${profitMargin.toFixed(1)}%`, class: profitClass }
            ];
            resultsData.forEach((result, index) => {
                const card = document.createElement('div');
                card.className = `result-card ${result.class} animated fadeInUp`;
                card.style.animationDelay = `${0.1 + index * 0.1}s`;
                card.innerHTML = `<span class="result-item-label" data-lang-key="${result.labelKey}">${langStrings[result.labelKey] || result.labelKey}</span><span class="result-item-value">${result.value}</span>`;
                resultsContent.appendChild(card);
            });
            resultsContainer.style.display = 'block';
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        function saveBlog() {
            const blogTextarea = document.getElementById('blogTextarea');
            if (!blogTextarea) return;
            const text = blogTextarea.value;
            try {
                localStorage.setItem('userBlogNote', text);
                alert(currentLang === 'ar' ? 'تم الحفظ!' : 'Saved!');
            } catch (e) {
                console.error("Error saving note:", e);
                alert('Error saving.');
            }
        }
        function playVideo(element, videoId) {
            const existingIframe = element.querySelector('iframe');
            if (existingIframe && existingIframe.src.includes(videoId)) return;
            element.style.padding = '0';
            element.style.backgroundColor = '#000';
            element.style.boxShadow = 'none';
            element.onclick = null;
            element.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&iv_load_policy=3" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen sandbox="allow-scripts allow-same-origin allow-presentation allow-popups"></iframe>`;
            element.classList.remove('animated', 'fadeInUp');
            element.style.animationDelay = '';
            element.style.transform = '';
        }
        function showPurchaseModal(buttonElement, courseId, encodedCourseTitle) {
            const courseTitle = unescape(encodedCourseTitle);
            const modal = document.getElementById('purchase-modal');
            const titleElement = document.getElementById('purchase-modal-title');
            const enterPassBtn = document.getElementById('purchase-modal-enter-pass-btn');
            if (!modal || !titleElement || !enterPassBtn) {
                console.error('Purchase modal elements not found.');
                return;
            }
            let titleText = currentLang === 'ar' ? 'خطوة أخيرة! - ' : 'Final Step! - ';
            titleElement.textContent = titleText + courseTitle;
            const cardElement = buttonElement.closest('.paid-course-card-new');
            if (!cardElement) {
                console.error('Could not find parent card element.');
                return;
            }
            enterPassBtn.onclick = function() {
                closePurchaseModal();
                showPasswordPrompt(cardElement, courseId);
            };
            modal.style.display = 'flex';
        }
        function closePurchaseModal() {
            const modal = document.getElementById('purchase-modal');
            if (modal) modal.style.display = 'none';
            const enterPassBtn = document.getElementById('purchase-modal-enter-pass-btn');
            if(enterPassBtn) enterPassBtn.onclick = null;
        }
        function showPasswordPrompt(cardElement, videoId) {
            const langStrings = uiStrings[currentLang];
            const course = contentData.paidCourses.find(c => c.id === videoId);
            if (!course || !Array.isArray(course.passwords)) {
                console.error('Course/pw invalid:', videoId);
                alert('Error: Course data missing.');
                return;
            }
            if (!cardElement) {
                console.error('Parent element missing for password prompt.');
                alert('Error: UI ref lost.');
                return;
            }
            currentCourseUnlockData = { id: videoId, passwords: course.passwords, element: cardElement };
            const modal = document.getElementById('password-modal');
            const inputField = document.getElementById('password-input-field');
            if (!modal || !inputField) {
                console.error('Password modal missing.');
                alert('Error display prompt.');
                return;
            }
            document.getElementById('password-modal-title').textContent = langStrings.enter_password_prompt_title;
            document.getElementById('password-modal-subtitle').textContent = langStrings.enter_password_prompt_subtitle;
            inputField.value = '';
            modal.style.display = 'flex';
            setTimeout(() => inputField.focus(), 50);
        }
        function closePasswordModal() {
            const modal = document.getElementById('password-modal');
            if (modal) modal.style.display = 'none';
            currentCourseUnlockData = { id: null, passwords: [], element: null };
            const inputField = document.getElementById('password-input-field');
            if (inputField) inputField.value = '';
        }
        function submitPassword() {
            const langStrings = uiStrings[currentLang];
            const inputField = document.getElementById('password-input-field');
            if (!inputField) return;
            const inputPassword = inputField.value.trim();
            const { id, passwords, element } = currentCourseUnlockData;
            if (!inputPassword) return;
            if (!id || !passwords || !element) {
                console.error('Submit invalid data state.');
                alert('Error. Try again.');
                closePasswordModal();
                return;
            }
            
            // --- MODIFIED PASSWORD CHECK ---
            // Check for admin-overridden passwords first
            let activePasswords = passwords;
            try {
                const storedPasswords = localStorage.getItem('course_passwords_' + id);
                if (storedPasswords) {
                    activePasswords = JSON.parse(storedPasswords);
                }
            } catch(e) { console.error("Failed to parse stored passwords:", e); }
            // --- END MODIFICATION ---

            const storageKey = `usedPasswords_${id}`;
            let usedPasswords = [];
            try {
                const stored = localStorage.getItem(storageKey);
                usedPasswords = stored ? JSON.parse(stored) : [];
                if (!Array.isArray(usedPasswords)) usedPasswords = [];
            } catch (e) { console.error(`Error read ${storageKey}:`, e); }
            
            const isValid = activePasswords.includes(inputPassword); // Use activePasswords
            const isUsed = usedPasswords.includes(inputPassword);
            const modalContent = document.querySelector('#password-modal .payment-modal-content');
            
            if (modalContent) modalContent.style.animation = 'none';
            void modalContent?.offsetWidth;
            
            if (isValid && !isUsed) {
                alert(langStrings.course_unlocked);
                usedPasswords.push(inputPassword);
                try { localStorage.setItem(storageKey, JSON.stringify(usedPasswords)); }
                catch (e) { console.error(`Error save ${storageKey}:`, e); alert('Note: Could not save password status.'); }
                closePasswordModal();
                unlockCourse(element, id);
            } else {
                const message = isValid && isUsed ? langStrings.password_expired : langStrings.wrong_password;
                alert(message);
                if (modalContent) modalContent.style.animation = 'shake 0.5s';
                inputField.select();
                inputField.focus();
            }
        }
        function unlockCourse(itemElement, videoId) {
            if (!itemElement) {
                console.error('Cannot unlock, element null for ID:', videoId);
                return;
            }
            const langStrings = uiStrings[currentLang];
            const youtubeLink = `https://www.youtube.com/watch?v=${videoId}`;
            itemElement.innerHTML = `
                <div class="video-player-unlocked">
                    <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&iv_load_policy=3"
                            frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            allowfullscreen sandbox="allow-scripts allow-same-origin allow-presentation allow-popups"></iframe>
                </div>
                <div class="video-actions">
                     <a href="${youtubeLink}" target="_blank" rel="noopener noreferrer" class="video-btn download-btn" style="flex: none; width: calc(100% - 20px); margin: 10px auto;">
                           ${langStrings.download} </a>
                </div>`;
            itemElement.style.padding = '0';
            itemElement.style.backgroundColor = '#000';
            itemElement.style.border = 'none';
            itemElement.classList.remove('animated', 'fadeInUp');
            itemElement.style.animationDelay = '';
        }
        function selectLanguage(element) {
            const lang = element.getAttribute('data-lang');
            if (lang && lang !== currentLang) {
                localStorage.setItem('selectedLanguage', lang);
                currentLang = lang;
                updateLanguageUI();
            }
            document.querySelectorAll('.language-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
        }
        function selectTheme(element) {
            const theme = element.getAttribute('data-theme');
            if (theme) {
                localStorage.setItem('selectedTheme', theme);
                const currentFontSize = localStorage.getItem('selectedFontSize') || 'font-medium';
                bodyEl.className = `${theme} ${currentFontSize}`;
                document.querySelectorAll('.theme-option').forEach(el => el.classList.remove('selected'));
                element.classList.add('selected');
            }
        }
        function selectFontSize(element) {
            const fontSize = element.getAttribute('data-font-size');
            if (fontSize) {
                localStorage.setItem('selectedFontSize', fontSize);
                const currentTheme = localStorage.getItem('selectedTheme') || 'dark-theme';
                bodyEl.className = `${currentTheme} ${fontSize}`;
                let baseSize = '16px';
                if (fontSize === 'font-small') baseSize = '14px';
                else if (fontSize === 'font-large') baseSize = '18px';
                document.documentElement.style.setProperty('--font-size-base', baseSize);
                document.querySelectorAll('.font-size-option').forEach(el => el.classList.remove('selected'));
                element.classList.add('selected');
            }
        }
        function loadSettingsUI() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'dark-theme';
            document.querySelectorAll('.theme-option').forEach(el => el.classList.toggle('selected', el.getAttribute('data-theme') === savedTheme));
            const savedLang = localStorage.getItem('selectedLanguage') || 'ar';
            document.querySelectorAll('.language-option').forEach(el => el.classList.toggle('selected', el.getAttribute('data-lang') === savedLang));
            const savedFontSize = localStorage.getItem('selectedFontSize') || 'font-medium';
            document.querySelectorAll('.font-size-option').forEach(el => el.classList.toggle('selected', el.getAttribute('data-font-size') === savedFontSize));
            let baseSize = '16px';
            if (savedFontSize === 'font-small') baseSize = '14px';
            else if (savedFontSize === 'font-large') baseSize = '18px';
            document.documentElement.style.setProperty('--font-size-base', baseSize);
        }
        function goBack() {
             // MODIFIED: If going back from login/signup fields, show initial buttons
            const loginFields = document.getElementById('login-fields');
            const signupFields = document.getElementById('signup-fields');
            if (loginFields.classList.contains('visible') || signupFields.classList.contains('visible')) {
                showInitialAuthButtons();
                return; // Don't pop history stack
            }
            
            if (historyStack.length > 1) {
                historyStack.pop();
                _renderSection(historyStack[historyStack.length - 1]);
            }
        }
        function toggleSidebar() {
            sidebar.classList.toggle("open");
        }

        // --- NEW ONLOAD LOGIC ---
        window.onload = function() {
            const loggedInUser = localStorage.getItem('loggedInUser');

            if (loggedInUser) {
                // User is logged in, initialize the main app
                initializeApp();
            } else {
                // No user logged in, show login screen
                const loginOverlay = document.getElementById('login-overlay');
                loginOverlay.style.display = 'flex'; // Show the overlay
                
                // Track visitor count for new sessions
                let count = localStorage.getItem('visitorCount') || 0;
                count = parseInt(count) + 1;
                localStorage.setItem('visitorCount', count);
                
                // Initialize Vanta.js 3D background
                try {
                    vantaEffect = VANTA.NET({
                        el: "#vanta-bg",
                        mouseControls: true,
                        touchControls: true,
                        gyroControls: false,
                        minHeight: 200.00,
                        minWidth: 200.00,
                        scale: 1.00,
                        scaleMobile: 1.00,
                        color: getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim(),
                        backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--dark-bg').trim(),
                        points: 10.00,
                        maxDistance: 25.00,
                        spacing: 18.00
                    });
                } catch (e) {
                    console.error("Vanta.js failed to load:", e);
                    document.getElementById('vanta-bg').style.backgroundColor = 'var(--dark-bg)'; // Fallback
                }
                
                // Load language for login screen
                currentLang = localStorage.getItem('selectedLanguage') || 'ar';
                updateLanguageUI(); // Apply language to login screen
                
                // Show initial buttons, hide fields
                showInitialAuthButtons();
            }
        };

        // --- ORIGINAL EVENT LISTENERS ---
        ['purchase-modal', 'password-modal', 'rating-modal-overlay'].forEach(id => {
            const m = document.getElementById(id);
            if(m) m.addEventListener('click', function(e){
                if(e.target === this) {
                    if (id === 'purchase-modal') closePurchaseModal();
                    else if (id === 'password-modal') closePasswordModal();
                    else if (id === 'rating-modal-overlay') closeRatingModal();
                }
            });
        });
        const pwInput = document.getElementById('password-input-field');
        if(pwInput) pwInput.addEventListener('keypress', function(e){
            if(e.key === 'Enter') {
                e.preventDefault();
                submitPassword();
            }
        });
        document.addEventListener('click', function(e) {
            const menuIcon = document.querySelector('.menu-icon');
            if (sidebar && menuIcon && sidebar.classList.contains('open') && !sidebar.contains(e.target) && !menuIcon.contains(e.target) && window.innerWidth <= 768) {
                sidebar.classList.remove('open');
            }
        });
        document.addEventListener('DOMContentLoaded', () => {
            const logo = document.querySelector('.logo-container img');
            if(logo){
                logo.addEventListener('mouseenter', ()=>{
                    logo.style.transform = 'scale(1.1) rotate(10deg)';
                    logo.style.boxShadow = '0 0 25px rgba(0, 123, 255, 0.8)';
                });
                logo.addEventListener('mouseleave', ()=>{
                    logo.style.transform = 'scale(1) rotate(0deg)';
                    logo.style.boxShadow = '0 0 15px rgba(0, 123, 255, 0.5)';
                });
            }
            
            // Add transition to auth forms for smooth switching
            const loginFields = document.getElementById('login-fields');
            const signupFields = document.getElementById('signup-fields');
            const initialButtons = document.getElementById('auth-initial-buttons');
            
            if(loginFields) loginFields.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            if(signupFields) signupFields.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            if(initialButtons) initialButtons.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            
        });
    </script>
</body>
</html>
