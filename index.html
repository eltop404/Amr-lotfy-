<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="default">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mora For Studying - Final Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/phosphor-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.globe.min.js"></script>
    <style>
        :root {
            --bg-color: #0d0d1a; --primary-glow: #00f5c3; --secondary-glow: #a78bfa;
            --text-primary: #e2e8f0; --text-secondary: #94a3b8;
            --glass-bg: rgba(15, 23, 42, 0.75); --glass-border: rgba(0, 245, 195, 0.1);
        }
        html[data-theme="gold"] { --primary-glow: #f59e0b; --secondary-glow: #fbbf24; }
        html[data-theme="emerald"] { --primary-glow: #10b981; --secondary-glow: #34d399; }
        html[data-theme="crimson"] { --primary-glow: #dc2626; --secondary-glow: #f87171; }
        
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg-color); color: var(--text-primary); overflow: hidden; transition: background-color 0.5s ease; }
        #app-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(at 20% 20%, var(--primary-glow) 0px, transparent 30%), radial-gradient(at 80% 80%, var(--secondary-glow) 0px, transparent 30%); animation: bg-pan 20s linear infinite alternate; opacity: 0.1; z-index: -1; transition: background-image 0.5s ease; }
        
        @keyframes bg-pan { from { transform: scale(1) rotate(0deg); } to { transform: scale(1.2) rotate(45deg); } }
        @keyframes cinematic-enter { from { opacity: 0; transform: scale(1.05); filter: blur(8px); } to { opacity: 1; transform: scale(1); filter: blur(0); } }
        @keyframes page-enter { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes glowing-logo-pulse { 0%, 100% { box-shadow: 0 0 25px var(--primary-glow), 0 0 50px var(--primary-glow); } 50% { box-shadow: 0 0 35px var(--secondary-glow), 0 0 70px var(--secondary-glow); } }
        @keyframes scroll-text-rtl { from { transform: translateX(-100%); } to { transform: translateX(100%); } }
        @keyframes lock-3d-swing { 0% { transform: perspective(100px) rotateY(-15deg); } 50% { transform: perspective(100px) rotateY(15deg) scale(1.1); } 100% { transform: perspective(100px) rotateY(-15deg); } }
        @keyframes loading-bar { from { width: 0%; } to { width: 100%; } }
        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); } 50% { transform: scale(1.05); box-shadow: 0 0 5px 10px rgba(255, 0, 0, 0); } }
        @keyframes random-float { 0%, 100% { transform: translateY(0px) rotate(0deg); } 25% { transform: translateY(-5px) rotate(3deg); } 50% { transform: translateY(2px) rotate(-1deg); } 75% { transform: translateY(-3px) rotate(2deg); } }

        .page { position: absolute; width: 100%; height: 100%; display: none; opacity: 0; animation: page-enter 0.5s ease forwards; }
        .page.active { display: flex; flex-direction: column; }
        #auth-page { z-index: 10; }
        #auth-page.active, #splash-screen.active { animation: cinematic-enter 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
        #auth-form-container { max-height: 100vh; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--primary-glow) transparent; }

        .glass-effect { background: var(--glass-bg); -webkit-backdrop-filter: blur(15px); backdrop-filter: blur(15px); border: 1px solid var(--glass-border); }
        .glowing-logo { animation: glowing-logo-pulse 4s infinite ease-in-out; }
        .input-field, .select-field { background: rgba(0, 0, 0, 0.4); border: 1px solid var(--glass-border); color: var(--text-primary); transition: all 0.3s ease; box-shadow: 0 0 10px rgba(0,0,0,0.5); padding: 0.65rem 1rem; }
        .input-field:focus, .select-field:focus { background: rgba(0, 0, 0, 0.2); box-shadow: 0 0 15px var(--primary-glow); border-color: var(--primary-glow); outline: none; }
        .input-field::placeholder { color: var(--text-secondary); }

        .btn-celestial { background: transparent; border: 2px solid var(--primary-glow); color: var(--primary-glow); text-shadow: 0 0 10px var(--primary-glow); box-shadow: 0 0 15px var(--primary-glow) inset, 0 0 5px var(--primary-glow); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .btn-celestial:hover:not(:disabled) { background: var(--primary-glow); color: var(--bg-color); transform: scale(1.05); box-shadow: 0 0 25px var(--primary-glow) inset, 0 0 20px var(--primary-glow); text-shadow: none; }
        .btn-celestial:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .scrolling-banner { position: absolute; top: 0; left: 0; width: 100%; background: rgba(2, 6, 23, 0.5); backdrop-filter: blur(5px); white-space: nowrap; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 60; }
        .scrolling-banner p { display: inline-block; padding: 6px 0; font-size: 0.8rem; animation: scroll-text-rtl 25s linear infinite; color: var(--primary-glow); text-shadow: 0 0 8px var(--primary-glow); font-weight: 600; }
        .bottom-nav { gap: 0.25rem; padding: 0.25rem 0.5rem; justify-content: space-around; }
        .bottom-nav-btn i { filter: drop-shadow(0 0 5px var(--primary-glow)); transition: all 0.3s ease; }
        .bottom-nav-btn:hover i { filter: drop-shadow(0 0 15px var(--primary-glow)); transform: scale(1.1) translateY(-2px); color: var(--primary-glow); }
        .lock-icon-3d { animation: lock-3d-swing 2.5s infinite ease-in-out; display: inline-block; }
        .modal { display: none; } .modal.open { display: flex; }
        #modal-body { scrollbar-width: thin; scrollbar-color: var(--primary-glow) transparent; }
        .social-icon-animated { animation: random-float 8s ease-in-out infinite; transition: all 0.3s ease; }
        .social-icon-animated:hover { transform: scale(1.2); filter: drop-shadow(0 0 8px var(--glow-color)); animation-play-state: paused; }
        .live-indicator { width: 10px; height: 10px; background-color: red; border-radius: 50%; animation: pulse 1.5s infinite; }
        .rating-star:hover, .rating-star.active { color: #f59e0b; transform: scale(1.2); }
        
        .settings-option {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--glass-border);
            padding: 0.75rem;
            border-radius: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .settings-option.selected, .settings-option:hover {
            border-color: var(--primary-glow);
            color: var(--primary-glow);
            box-shadow: 0 0 10px var(--primary-glow);
        }
    </style>
</head>
<body class="w-full h-screen">
    <div id="app-bg"></div>
    <div id="app-container" class="w-full h-full relative">
        <div id="auth-page" class="page justify-center items-center p-4">
            <div id="auth-form-container" class="w-full h-full flex justify-center items-center p-4"></div>
        </div>
        <div id="splash-screen" class="page justify-center items-center p-4 text-center">
            <p class="text-xl font-semibold mb-8 tracking-wider text-shadow" style="color:var(--primary-glow)">Ù…ØªÙ†Ø³Ø§Ø´ ØªØµÙ„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º</p>
            <div class="w-40 h-1 bg-[var(--glass-border)] rounded-full"><div class="h-full bg-[var(--primary-glow)] rounded-full animate-[loading-bar_1s_linear_forwards]"></div></div>
        </div>
        <div id="student-dashboard" class="page h-screen w-screen overflow-hidden">
            <div class="scrolling-banner"><p>Ø´ÙƒØ± Ø®Ø§Øµ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù‡Ø¯ ÙˆØ£Ø¹Ø¶Ø§Ø¡ Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³ ÙÙŠ ØªØ·ÙˆÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ ***&nbsp;</p></div>
            <header class="p-4 flex justify-between items-center glass-effect mt-10" style="border: none;">
                <div class="flex items-center gap-3">
                    <img src="https://i.postimg.cc/mgdFZ313/IMG-20250414-WA0047-1.jpg" alt="Logo" class="w-12 h-12 rounded-full glowing-logo">
                    <div id="timer-indicator" class="hidden items-center gap-2">
                        <div class="live-indicator"></div>
                        <span class="text-xs text-red-400 font-bold">Ù…Ø¨Ø§Ø´Ø±</span>
                    </div>
                </div>
                <div class="text-right"><h2 id="welcome-name" class="font-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ ...</h2><p id="user-details" class="text-xs text-slate-400">...</p><div class="flex items-center justify-end gap-2 mt-1"><i id="rewards-icon" class="ph-trophy text-xl text-yellow-400 cursor-pointer transition-transform hover:scale-125"></i><span id="points-display" class="text-yellow-400 font-bold">0</span></div></div>
            </header>
            <main class="flex-grow p-4 overflow-y-auto pb-24"><div id="materials-list" class="space-y-3"></div></main>
            <nav class="fixed bottom-0 right-0 left-0 glass-effect flex text-xs z-50 bottom-nav">
                <button onclick="openContentModal('books')" class="bottom-nav-btn flex flex-col items-center space-y-1"><i class="ph-books text-xl"></i><span>Ø§Ù„ÙƒØªØ¨</span></button>
                <button onclick="openContentModal('sections')" class="bottom-nav-btn flex flex-col items-center space-y-1"><i class="ph-stack-simple text-xl"></i><span>Ø§Ù„Ø³ÙƒØ§Ø´Ù†</span></button>
                <button id="meeting-btn" class="bottom-nav-btn flex flex-col items-center space-y-1"><i class="ph-lock-key lock-icon-3d text-xl"></i><span>Ù…ÙŠØªÙ†Ø¬</span></button>
                <button id="courses-btn" class="bottom-nav-btn flex flex-col items-center space-y-1"><i id="courses-icon" class="ph-lock-key lock-icon-3d text-xl"></i><span>ÙƒÙˆØ±Ø³Ø§Øª</span></button>
                <button data-modal="ai-tools-modal" class="bottom-nav-btn flex flex-col items-center space-y-1"><i class="ph-robot text-xl"></i><span>Ø£Ø¯ÙˆØ§Øª AI</span></button>
                <button data-modal="opinions-modal" class="bottom-nav-btn flex flex-col items-center space-y-1"><i class="ph-chats-teardrop text-xl"></i><span>Ø¢Ø±Ø§Ø¡</span></button>
                <button data-modal="about-modal" class="bottom-nav-btn flex flex-col items-center space-y-1"><i class="ph-info text-xl"></i><span>Ø¹Ù†Ø§</span></button>
                <button data-modal="settings-modal" class="bottom-nav-btn flex flex-col items-center space-y-1"><i class="ph-gear-six text-xl"></i><span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></button>
            </nav>
        </div>
        
        <div id="subject-content-page" class="page h-screen w-screen overflow-hidden">
            </div>

        <div id="admin-dashboard" class="page h-screen w-screen overflow-hidden">
             <div class="flex h-full">
                 <aside class="w-72 glass-effect p-4 flex flex-col"><h1 class="text-2xl font-bold text-[var(--primary-glow)] mb-8">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1><nav class="flex-grow flex flex-col space-y-2 overflow-y-auto"><button data-panel="info-panel" class="admin-nav-btn text-right p-3 rounded-lg hover:bg-slate-700/50 transition">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button><button data-panel="students-panel" class="admin-nav-btn text-right p-3 rounded-lg hover:bg-slate-700/50 transition">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</button><button data-panel="content-panel" class="admin-nav-btn text-right p-3 rounded-lg hover:bg-slate-700/50 transition">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button><button data-panel="courses-panel" class="admin-nav-btn text-right p-3 rounded-lg hover:bg-slate-700/50 transition">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</button><button data-panel="ai-tools-panel" class="admin-nav-btn text-right p-3 rounded-lg hover:bg-slate-700/50 transition">Ø¥Ø¯Ø§Ø±Ø© Ø£Ø¯ÙˆØ§Øª AI</button><button data-panel="opinions-panel" class="admin-nav-btn text-right p-3 rounded-lg hover:bg-slate-700/50 transition">Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨</button><button data-panel="ratings-panel" class="admin-nav-btn text-right p-3 rounded-lg hover:bg-slate-700/50 transition">ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</button><button data-panel="settings-panel" class="admin-nav-btn text-right p-3 rounded-lg hover:bg-slate-700/50 transition">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</button></nav><div class="mt-auto flex-shrink-0 pt-4"><button id="admin-logout-btn" class="w-full py-2 rounded-lg text-lg font-bold btn-celestial border-red-500 text-red-500 hover:bg-red-500 hover:text-white">Ø®Ø±ÙˆØ¬</button></div></aside>
                 <main class="flex-grow p-8 overflow-y-auto"><div id="info-panel" class="admin-panel"><h2 class="text-3xl font-bold mb-6">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h2><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-center"><div class="glass-effect p-6 rounded-lg"><h3 class="text-lg text-slate-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</h3><p id="admin-student-count" class="text-4xl font-bold text-[var(--primary-glow)] mt-2">0</p></div><div class="glass-effect p-6 rounded-lg"><h3 class="text-lg text-slate-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¢Ø±Ø§Ø¡</h3><p id="admin-opinions-count" class="text-4xl font-bold text-[var(--secondary-glow)] mt-2">0</p></div><div class="glass-effect p-6 rounded-lg"><h3 class="text-lg text-slate-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h3><p id="admin-ratings-count" class="text-4xl font-bold text-yellow-400 mt-2">0</p></div><div class="glass-effect p-6 rounded-lg"><h3 class="text-lg text-slate-400">Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</h3><p class="text-4xl font-bold text-green-400 mt-2">!</p></div></div></div><div id="students-panel" class="admin-panel hidden"><h2 class="text-3xl font-bold mb-6">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2><div id="admin-students-list" class="space-y-4"></div></div><div id="content-panel" class="admin-panel hidden"><h2 class="text-3xl font-bold mb-6">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h2><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div><div class="glass-effect p-6 rounded-lg"><h3 id="content-form-title" class="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</h3><select id="content-type-select" class="w-full rounded-lg select-field appearance-none mb-4"><option value="lectures">Ù…Ø­Ø§Ø¶Ø±Ø©</option><option value="books">ÙƒØªØ§Ø¨</option><option value="sections">Ø³ÙƒØ´Ù†</option></select><select id="content-year-select" class="w-full rounded-lg select-field appearance-none mb-4"><option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ù‚Ø©</option><option value="1">Ø§Ù„Ø£ÙˆÙ„Ù‰</option><option value="2">Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option></select><select id="content-division-select" class="w-full rounded-lg select-field appearance-none mb-4"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option><option value="international">Ø£Ø¹Ù…Ø§Ù„ Ø¯ÙˆÙ„ÙŠØ©</option><option value="systems">Ù†Ø¸Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option></select><select id="content-subject-select" class="w-full rounded-lg select-field appearance-none mb-4"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹</option></select><input id="content-title-input" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰" class="w-full rounded-lg input-field mb-4"><textarea id="content-body-input" placeholder="Ù†Øµ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø·..." class="w-full rounded-lg input-field mb-4" rows="4"></textarea><div class="flex gap-4"><button id="save-content-btn" class="w-full py-2 rounded-lg text-sm font-bold btn-celestial">Ø­ÙØ¸</button><button id="cancel-edit-btn" class="w-full py-2 rounded-lg text-sm font-bold btn-celestial border-yellow-500 text-yellow-500 hover:bg-yellow-500 hover:text-black hidden">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button></div></div></div><div><h3 class="text-xl font-bold mb-4">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¶Ø§Ù Ø­Ø§Ù„ÙŠÙ‹Ø§</h3><div id="admin-content-list" class="space-y-3"></div></div></div></div><div id="courses-panel" class="admin-panel hidden"><h2 class="text-3xl font-bold mb-6">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</h2><div class="glass-effect p-6 rounded-lg mb-6"><h3 class="font-bold mb-4">Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³ Ø¬Ø¯ÙŠØ¯</h3><input id="course-title-input" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒÙˆØ±Ø³" class="w-full rounded-lg input-field mb-4"><textarea id="course-desc-input" placeholder="ÙˆØµÙ Ø§Ù„ÙƒÙˆØ±Ø³" class="w-full rounded-lg input-field mb-4" rows="3"></textarea><input id="course-url-input" type="text" placeholder="Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ÙƒÙˆØ±Ø³" class="w-full rounded-lg input-field mb-4"><button id="add-course-btn" class="w-full py-2 rounded-lg font-bold btn-celestial">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ±Ø³</button></div><div id="admin-courses-list" class="space-y-4"></div></div><div id="ai-tools-panel" class="admin-panel hidden"><h2 class="text-3xl font-bold mb-6">Ø¥Ø¯Ø§Ø±Ø© Ø£Ø¯ÙˆØ§Øª AI</h2><div class="glass-effect p-6 rounded-lg mb-6"><h3 class="font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ø£Ø¯Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3><input id="ai-name-input" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ø§Ø©" class="w-full rounded-lg input-field mb-4"><input id="ai-desc-input" type="text" placeholder="ÙˆØµÙ Ø§Ù„Ø£Ø¯Ø§Ø©" class="w-full rounded-lg input-field mb-4"><input id="ai-url-input" type="text" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¯Ø§Ø©" class="w-full rounded-lg input-field mb-4"><button id="add-ai-tool-btn" class="w-full py-2 rounded-lg font-bold btn-celestial">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¯Ø§Ø©</button></div><div id="admin-ai-tools-list" class="space-y-4"></div></div><div id="opinions-panel" class="admin-panel hidden"><h2 class="text-3xl font-bold mb-6">Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨</h2><div id="admin-opinions-list" class="space-y-4"></div></div><div id="ratings-panel" class="admin-panel hidden"><h2 class="text-3xl font-bold mb-6">ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2><div id="admin-ratings-list" class="space-y-4"></div></div><div id="settings-panel" class="admin-panel hidden"><h2 class="text-3xl font-bold mb-6">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2><div class="glass-effect p-6 rounded-lg space-y-4"><label class="flex items-center justify-between cursor-pointer"><span class="font-bold">ØªÙØ¹ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ù…ÙŠØªÙ†Ø¬</span><input type="checkbox" id="meeting-toggle" class="form-checkbox h-5 w-5 text-green-500 rounded"></label><div id="meeting-url-container" class="hidden"><input type="url" id="meeting-url-input" placeholder="Ø§Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙŠØªÙ†Ø¬ Ù‡Ù†Ø§" class="w-full rounded-lg input-field"><button id="save-meeting-url-btn" class="w-full mt-2 py-2 rounded-lg text-sm btn-celestial">Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø·</button></div></div></div></main>
             </div>
        </div>
    </div>
    <div id="generic-modal" class="modal fixed inset-0 bg-black/60 backdrop-blur-md z-[1000] justify-center items-center p-4"><div class="modal-content glass-effect w-full max-w-lg max-h-[90vh] overflow-y-auto p-6 rounded-2xl flex flex-col"><div class="flex justify-between items-center mb-4 flex-shrink-0"><h3 id="modal-title" class="text-2xl font-bold text-[var(--primary-glow)]"></h3><button class="modal-close-btn text-3xl hover:text-red-500 transition">&times;</button></div><div id="modal-body" class="overflow-y-auto flex-grow"></div></div></div>
    <div id="toast-notification" class="fixed top-5 right-5 glass-effect p-4 rounded-lg shadow-lg z-[2000] opacity-0 -translate-y-12 transition-all duration-500"><p id="toast-message"></p></div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, doc, addDoc, getDocs, query, where, onSnapshot, deleteDoc, updateDoc, orderBy, serverTimestamp, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyB92ooyA5_tTx1BLDp2EWmqxHuJQ3zqah4", authDomain: "mora-for-studying.firebaseapp.com", projectId: "mora-for-studying", storageBucket: "mora-for-studying.firebasestorage.app", messagingSenderId: "213416531900", appId: "1:213416531900:web:2e4d8bd2a9e1a4e814bdb9" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let currentUser = null;
        let vantaEffect = null;
        let currentEditState = { id: null, collection: null };
        let currentContentUnsubscribe = null; // To hold the real-time listener unsubscribe function
        const materials = { '1_international': [ 'Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø§Ù„ÙŠÙ‡', 'Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯', 'Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†', 'Ù„ØºÙ‡ Ø§Ø¬Ù†Ø¨ÙŠÙ‡ (1)', 'Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ø¯Ø§Ø±Ù‡ Ø§Ù„Ø§Ø¹Ù…Ø§Ù„' ], '1_systems': ['Ø·Ø±Ù‚ ÙˆÙ…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„', 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ø§Ø¹Ù…Ø§Ù„', 'Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø§Ù†Ø³Ø§Ù†', 'Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±ÙŠ', 'Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ', 'Ø§Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø­Ø§Ø³Ø¨ ÙˆØªÙƒØªÙˆÙ„ÙˆÚ†ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª'], '2_international': ['Ø§Ø¯Ø§Ø±Ù‡ Ø§Ù„Ù„ÙˆÚ†ÙŠØ³ØªÙŠØ§Øª ÙˆØ³Ù„Ø§Ø³Ù„ Ø§Ù„Ø§Ù…Ø¯Ø§Ø¯', 'Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„ØªØ³ÙˆÙŠÙ‚', 'Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ Ø§Ù„Ø¬Ø²Ø¦ÙŠ', 'Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ', 'Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø§Ø¹Ù…Ø§Ù„'], '2_systems': ['Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø§Ø¹Ù…Ø§Ù„', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (1)', 'Ø§Ø¯Ø§Ø±Ù‡ Ø§Ù„Ø§Ù†ØªØ§Ø¬', 'Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù„Ø´Ø±ÙƒØ§Øª', 'ØªØµÙ…ÙŠÙ… Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø­Ø§Ø³Ø¨'] };
        const studentDashboardEl = { welcomeName: document.getElementById('welcome-name'), userDetails: document.getElementById('user-details'), materialsList: document.getElementById('materials-list'), pointsDisplay: document.getElementById('points-display'), timerIndicator: document.getElementById('timer-indicator') };
        const adminDashboardEl = { studentCount: document.getElementById('admin-student-count'), opinionsCount: document.getElementById('admin-opinions-count'), ratingsCount: document.getElementById('admin-ratings-count'), studentsList: document.getElementById('admin-students-list'), opinionsList: document.getElementById('admin-opinions-list'), coursesList: document.getElementById('admin-courses-list'), aiToolsList: document.getElementById('admin-ai-tools-list'), ratingsList: document.getElementById('admin-ratings-list') };
        const adminContentPanelEl = { type: document.getElementById('content-type-select'), year: document.getElementById('content-year-select'), division: document.getElementById('content-division-select'), subject: document.getElementById('content-subject-select'), title: document.getElementById('content-title-input'), body: document.getElementById('content-body-input'), saveBtn: document.getElementById('save-content-btn'), formTitle: document.getElementById('content-form-title'), contentList: document.getElementById('admin-content-list'), cancelBtn: document.getElementById('cancel-edit-btn') };
        function showPage(pageId) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(pageId).classList.add('active'); }
        function showToast(message, isError = false) { const t = document.getElementById('toast-notification'), m = document.getElementById('toast-message'); m.textContent = message; t.className = `fixed top-5 right-5 glass-effect p-4 rounded-lg shadow-lg z-[2000] opacity-100 translate-y-0 transition-all duration-500 ${isError ? 'bg-red-900/50 text-white' : 'bg-green-900/50 text-white'}`; setTimeout(() => { t.className = t.className.replace('opacity-100', 'opacity-0').replace('translate-y-0', '-translate-y-12'); }, 4000); }
        function openModalWithContent(title, body) { document.getElementById('modal-title').textContent = title; document.getElementById('modal-body').innerHTML = body; document.getElementById('generic-modal').classList.add('open'); }
        function initVantaBackground() { try { if (vantaEffect) return; vantaEffect = VANTA.GLOBE({ el: "#auth-page", mouseControls: true, touchControls: true, gyroControls: false, minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00, color: 0x00f5c3, color2: 0xa78bfa, backgroundColor: 0x0d0d1a, size: 1.2 }); } catch(e) { console.error("Vanta failed to initialize", e); } }
        function destroyVantaBackground() { try { if (vantaEffect) { vantaEffect.destroy(); vantaEffect = null; } } catch (e) { console.error("Vanta failed to destroy", e); } }
        function generateCaptcha() { const chars = 'ABCDEFGHIJKLMNPQRSTUVWXYZ123456789'; let captcha = ''; for (let i = 0; i < 5; i++) { captcha += chars.charAt(Math.floor(Math.random() * chars.length)); } return captcha; }
        function renderAuthForm(isInitial = true, showRegister = false) { const authFormContainer = document.getElementById('auth-form-container'); authFormContainer.innerHTML = `<div class="relative text-center w-full max-w-sm z-20 py-8" style="animation: fade-in-up 0.5s 0.1s ease-out backwards;"><img src="https://i.postimg.cc/mgdFZ313/IMG-20250414-WA0047-1.jpg" alt="" class="w-28 h-28 rounded-full mb-4 glowing-logo mx-auto" style="animation: fade-in-up 0.5s 0.2s ease-out backwards;"><h1 class="text-2xl font-bold mb-1 tracking-wider text-shadow" style="color:var(--primary-glow); animation: fade-in-up 0.5s 0.3s ease-out backwards;">Welcome to Mora</h1><p class="text-xs text-slate-300 mb-6" style="animation: fade-in-up 0.5s 0.4s ease-out backwards;">For Studying</p><div id="auth-content"></div></div>`; const authContent = document.getElementById('auth-content'); if (isInitial) { authContent.innerHTML = `<div class="space-y-3" style="animation: fade-in-up 0.6s 0.5s ease-out backwards;"><button id="go-to-register-btn" class="w-40 mx-auto block py-1.5 rounded-lg text-sm font-bold btn-celestial">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button><button id="go-to-login-btn" class="w-40 mx-auto block py-1.5 rounded-lg text-sm font-bold btn-celestial">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button></div>`; } else { const captcha = generateCaptcha(); authContent.innerHTML = `<div class="w-full max-w-md mx-auto relative"><button id="back-to-initial-btn" class="absolute top-0 right-0 text-2xl text-slate-400 hover:text-white transition-transform hover:scale-110"><i class="ph-arrow-right"></i></button><div class="space-y-3 pt-8"><input type="text" id="auth-name" placeholder="Ø§Ù„Ø§Ø³Ù…" class="w-full rounded-lg text-center input-field">${showRegister ? `<select id="auth-year" class="w-full rounded-lg text-center select-field appearance-none"><option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ù‚Ø©</option><option value="1">Ø§Ù„Ø£ÙˆÙ„Ù‰</option><option value="2">Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option></select><select id="auth-division" class="w-full rounded-lg text-center select-field appearance-none"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option><option value="international">Ø£Ø¹Ù…Ø§Ù„ Ø¯ÙˆÙ„ÙŠØ©</option><option value="systems">Ù†Ø¸Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option></select>` : ''}<div class="relative"><input type="password" id="auth-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full rounded-lg text-center input-field pr-10"><button id="toggle-password" type="button" class="absolute top-1/2 -translate-y-1/2 right-3 text-slate-400 hover:text-white"><i id="eye-icon" class="ph-eye"></i></button></div>${showRegister ? `<p class="text-xs text-slate-400 -mt-2">ÙŠØ¬Ø¨ Ø£Ù„Ø§ ØªÙ‚Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù† 8 Ø£Ø­Ø±Ù ÙˆØ£Ø±Ù‚Ø§Ù… Ø¨Ø§Ù„Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ</p><div class="flex items-center justify-center gap-4"><span id="captcha-challenge" class="p-2 glass-effect rounded-lg font-bold text-xl tracking-widest">${captcha}</span><input type="text" id="captcha-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²" class="w-28 rounded-lg text-center input-field"><button type="button" id="refresh-captcha" class="text-2xl text-slate-400 hover:text-white transition"><i class="ph-arrows-clockwise"></i></button></div>` : ''}<p id="auth-error-msg" class="text-red-400 h-5"></p><button id="auth-submit-btn" class="w-full py-2 rounded-lg text-sm font-bold btn-celestial">${showRegister ? 'Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†' : 'Ø¯Ø®Ù€Ù€Ù€Ù€ÙˆÙ„'}</button><button id="auth-toggle-btn" type="button" class="text-xs text-slate-400 hover:text-[var(--primary-glow)] transition">${showRegister ? 'Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ' : 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ'}</button></div></div>`; } const elementsToAnimate = authContent.querySelectorAll('input, select, button, div, p'); elementsToAnimate.forEach((el, index) => { el.style.animation = `fade-in-up 0.6s ${0.5 + index * 0.08}s ease-out backwards`; }); if (isInitial) { document.getElementById('go-to-register-btn').addEventListener('click', () => renderAuthForm(false, true)); document.getElementById('go-to-login-btn').addEventListener('click', () => renderAuthForm(false, false)); } else { document.getElementById('back-to-initial-btn').addEventListener('click', () => renderAuthForm(true)); document.getElementById('auth-toggle-btn').addEventListener('click', () => renderAuthForm(false, !showRegister)); document.getElementById('auth-submit-btn').addEventListener('click', showRegister ? handleRegister : handleLogin); if (showRegister) document.getElementById('refresh-captcha').addEventListener('click', () => document.getElementById('captcha-challenge').textContent = generateCaptcha()); document.getElementById('toggle-password').addEventListener('click', () => { const passInput = document.getElementById('auth-password'); const eyeIcon = document.getElementById('eye-icon'); const isPassword = passInput.type === 'password'; passInput.type = isPassword ? 'text' : 'password'; eyeIcon.className = isPassword ? 'ph-eye-slash' : 'ph-eye'; }); } }
        async function handleRegister() {
            const submitBtn = document.getElementById('auth-submit-btn');
            const errorMsg = document.getElementById('auth-error-msg');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            errorMsg.textContent = '';
            try {
                const name = document.getElementById('auth-name').value.trim();
                const year = document.getElementById('auth-year').value;
                const division = document.getElementById('auth-division').value;
                const password = document.getElementById('auth-password').value;
                const captchaInput = document.getElementById('captcha-input').value;
                const captchaChallenge = document.getElementById('captcha-challenge').textContent;

                if (!name || !year || !division || !password || !captchaInput) throw new Error('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                if (password.length < 8) throw new Error('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                if (captchaInput.toUpperCase() !== captchaChallenge.toUpperCase()) throw new Error('Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­');

                const q = query(collection(db, "users"), where("name", "==", name));
                const querySnapshot = await getDocs(q);
                if (!querySnapshot.empty) throw new Error('Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„');
                
                // Get IP Address and Device Info
                let ipAddress = 'ØºÙŠØ± Ù…ØªØ§Ø­';
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    ipAddress = data.ip;
                } catch (ipError) {
                    console.error('Could not fetch IP address:', ipError);
                }
                const userAgent = navigator.userAgent;

                const newUser = { name, year, division, password, points: 0, isBanned: false, createdAt: serverTimestamp(), completedLectures: [], ipAddress, userAgent };
                const docRef = await addDoc(collection(db, "users"), newUser);
                
                currentUser = {id: docRef.id, ...newUser};
                sessionStorage.setItem('moraUser', JSON.stringify(currentUser));
                destroyVantaBackground();
                showPage('splash-screen');
            } catch (error) {
                errorMsg.textContent = error.message;
                submitBtn.disabled = false;
                submitBtn.textContent = 'Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†';
            }
        }
        async function handleLogin() { const submitBtn = document.getElementById('auth-submit-btn'); const errorMsg = document.getElementById('auth-error-msg'); submitBtn.disabled = true; submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...'; errorMsg.textContent = ''; try { const name = document.getElementById('auth-name').value.trim(); const password = document.getElementById('auth-password').value; if (!name || !password) { throw new Error('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); } if (name === 'admen' && password === 'Amr1221@gmail.com') { destroyVantaBackground(); currentUser = { name: 'Admin', isAdmin: true }; sessionStorage.setItem('moraUser', JSON.stringify(currentUser)); showPage('splash-screen'); return; } const q = query(collection(db, "users"), where("name", "==", name), where("password", "==", password)); const snapshot = await getDocs(q); if (snapshot.empty) { throw new Error('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ø£Ùˆ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹'); } const userDoc = snapshot.docs[0]; if (userDoc.data().isBanned) { throw new Error('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø­Ø¸ÙˆØ±'); } destroyVantaBackground(); currentUser = { id: userDoc.id, ...userDoc.data() }; sessionStorage.setItem('moraUser', JSON.stringify(currentUser)); showPage('splash-screen'); } catch (error) { errorMsg.textContent = error.message; submitBtn.disabled = false; submitBtn.textContent = 'Ø¯Ø®Ù€Ù€Ù€Ù€ÙˆÙ„'; } }
        function initStudentDashboard() { showPage('student-dashboard'); studentDashboardEl.welcomeName.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ ${currentUser.name}`; studentDashboardEl.userDetails.textContent = `${'1' === currentUser.year ? "Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰" : "Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©"} - ${"international" === currentUser.division ? "Ø£Ø¹Ù…Ø§Ù„ Ø¯ÙˆÙ„ÙŠØ©" : "Ù†Ø¸Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª"}`; studentDashboardEl.pointsDisplay.textContent = currentUser.points || 0; loadMaterialsForStudent(); checkCourseUnlock(); listenToSiteSettings(); document.getElementById('rewards-icon').addEventListener('click', () => { showToast('Ù„ÙØªØ­ Ù‚Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³Ø§ØªØŒ Ø§Ø¬Ù…Ø¹ 100 Ù†Ù‚Ø·Ø©. ÙƒÙ„ Ù…Ø­Ø§Ø¶Ø±Ø© ØªØ´Ø§Ù‡Ø¯Ù‡Ø§ ØªÙ…Ù†Ø­Ùƒ 25 Ù†Ù‚Ø·Ø©! ğŸ†'); }); }
        function loadMaterialsForStudent() { const userMaterials = materials[`${currentUser.year}_${currentUser.division}`] || []; studentDashboardEl.materialsList.innerHTML = userMaterials.map(mat => `<div class="glass-effect p-4 rounded-lg flex justify-between items-center cursor-pointer hover:bg-[var(--glass-border)] transition" onclick="openSubjectPage('${mat}')"><h4 class="text-lg font-semibold">${mat}</h4><i class="ph-caret-left text-xl"></i></div>`).join(''); }
        
        window.goBackToDashboard = () => {
            if (currentContentUnsubscribe) currentContentUnsubscribe(); // Detach the real-time listener
            showPage('student-dashboard');
            document.getElementById('subject-content-page').innerHTML = '';
        }

        window.openSubjectPage = (subject) => {
            const subjectPage = document.getElementById('subject-content-page');
            const pageHTML = `
                <header class="p-4 flex justify-between items-center glass-effect" style="border:none; border-bottom: 1px solid var(--glass-border);">
                    <h2 class="text-xl font-bold text-[var(--primary-glow)]">Ù…Ø­Ø§Ø¶Ø±Ø§Øª: ${subject}</h2>
                    <button onclick="goBackToDashboard()" class="text-3xl hover:text-[var(--primary-glow)] transition"><i class="ph-arrow-right"></i></button>
                </header>
                <main class="flex-grow p-4 overflow-y-auto pb-5">
                    <div id="subject-lectures" class="text-center pt-4"><i class="ph-spinner ph-spin text-2xl"></i></div>
                </main>
            `;
            subjectPage.innerHTML = pageHTML;
            showPage('subject-content-page');
            const lecturesContainer = document.getElementById('subject-lectures');
            const q = query(collection(db, 'lectures'), where("year", "==", currentUser.year), where("division", "==", currentUser.division), where("subject", "==", subject), where("isHidden", "==", false), orderBy('createdAt', 'desc'));
            currentContentUnsubscribe = onSnapshot(q, (snapshot) => {
                if (snapshot.empty) {
                    lecturesContainer.innerHTML = `<p class="text-slate-400 py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù…Ù†Ø´ÙˆØ±Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`;
                } else {
                    let contentHTML = '<div class="space-y-3">';
                    snapshot.forEach(doc => {
                        const item = doc.data();
                        contentHTML += `<div class="glass-effect p-3 rounded-lg cursor-pointer hover:bg-[var(--glass-border)] transition-colors" onclick="viewContentDetail('${doc.id}', '${item.title}', '${btoa(encodeURIComponent(item.body))}')"><h4 class="font-bold text-white">${item.title}</h4></div>`;
                    });
                    contentHTML += '</div>';
                    lecturesContainer.innerHTML = contentHTML;
                }
            }, (error) => {
                console.error("Error with real-time listener:", error);
                lecturesContainer.innerHTML = `<p class="text-red-400 py-4">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª.</p>`;
            });
        };

        window.viewContentDetail = async (id, title, body) => { if(!currentUser.isAdmin && !(currentUser.completedLectures || []).includes(id)){ const newPoints = (currentUser.points || 0) + 25; const newCompleted = [...(currentUser.completedLectures || []), id]; await updateDoc(doc(db, "users", currentUser.id), { points: newPoints, completedLectures: newCompleted }); currentUser.points = newPoints; currentUser.completedLectures = newCompleted; sessionStorage.setItem('moraUser', JSON.stringify(currentUser)); studentDashboardEl.pointsDisplay.textContent = newPoints; checkCourseUnlock(); showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© 25 Ù†Ù‚Ø·Ø©! âœ¨');} openModalWithContent(title, `<div class="p-2" style="white-space: pre-wrap; user-select: text;">${decodeURIComponent(atob(body))}</div>`); };
        window.openContentModal = async (type) => { const title = type === 'books' ? 'Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©' : 'Ø§Ù„Ø³ÙƒØ§Ø´Ù†'; openModalWithContent(title, `<div id="modal-content-list" class="text-center"><i class="ph-spinner ph-spin text-2xl"></i></div>`); const container = document.getElementById('modal-content-list'); const q = query(collection(db, type), where("year", "==", currentUser.year), where("division", "==", currentUser.division), where("isHidden", "==", false), orderBy('createdAt', 'desc')); currentContentUnsubscribe = onSnapshot(q, (snapshot) => { let content = ''; if (snapshot.empty) { content = `<div class="text-center p-4"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</p></div>`; } else { content = '<div class="space-y-3">'; snapshot.forEach(doc => { const item = doc.data(); content += `<div class="glass-effect p-3 rounded-lg"><h4 class="font-bold text-[var(--primary-glow)]">${item.title} (${item.subject})</h4><p class="text-sm mt-2">${item.body}</p></div>`; }); content += '</div>'; } container.innerHTML = content; }); };
        function checkCourseUnlock() { const icon = document.getElementById('courses-icon'); if ((currentUser.points || 0) >= 100) { icon.classList.remove('ph-lock-key', 'lock-icon-3d'); icon.classList.add('ph-video'); } else { icon.classList.add('ph-lock-key', 'lock-icon-3d'); icon.classList.remove('ph-video'); } }
        async function listenToSiteSettings() { onSnapshot(doc(db, "settings", "site"), (doc) => { const settings = doc.data() || {}; const meetingBtn = document.getElementById('meeting-btn'); if (settings.meetingActive && settings.meetingUrl) { meetingBtn.innerHTML = `<i class="ph-video-camera text-xl text-red-500"></i><span class="text-red-500 font-bold">Ù…Ø¨Ø§Ø´Ø± 3D</span>`; meetingBtn.onclick = () => window.open(settings.meetingUrl, '_blank'); } else { meetingBtn.innerHTML = `<i class="ph-lock-key lock-icon-3d text-xl"></i><span>Ù…ÙŠØªÙ†Ø¬</span>`; meetingBtn.onclick = () => showToast('Ø³ÙˆÙ ÙŠØªÙ… ÙØªØ­ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¹Ù†Ø¯ Ø´Ø±Ø­ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†'); } }); }
        document.getElementById('courses-btn').addEventListener('click', async () => { if ((currentUser.points || 0) >= 100) { const q = query(collection(db, "courses"), orderBy("category")); const snapshot = await getDocs(q); let content = '<div class="space-y-4">'; let currentCategory = ""; if (snapshot.empty) { content += '<p class="text-center text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆØ±Ø³Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>'; } else { snapshot.forEach(doc => { const course = doc.data(); if(course.category !== currentCategory) { currentCategory = course.category; content += `<h4 class="text-lg font-bold text-[var(--primary-glow)] pt-2">${currentCategory}</h4>`; } content += `<div onclick="handleLinkRedirect('${course.url}')" class="p-3 rounded-lg cursor-pointer transition-all duration-300 hover:bg-slate-500/20"><h5 class="font-bold text-white">${course.title}</h5><p class="text-xs text-slate-400">${course.desc}</p></div>`; }); } content += '</div>'; openModalWithContent('Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©', content); } else { showToast(`Ù„ÙØªØ­ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø¬Ù…Ø¹ 100 Ù†Ù‚Ø·Ø©.`, true); }});
        function initAdminDashboard() { showPage('admin-dashboard'); const navBtns = document.querySelectorAll('.admin-nav-btn'), panels = document.querySelectorAll('.admin-panel'); navBtns.forEach(btn => btn.addEventListener('click', e => { navBtns.forEach(b => b.classList.remove('bg-[var(--primary-glow)]/30')); e.currentTarget.classList.add('bg-[var(--primary-glow)]/30'); panels.forEach(p => p.classList.add('hidden')); document.getElementById(e.currentTarget.dataset.panel).classList.remove('hidden'); })); navBtns[0].click(); onSnapshot(collection(db, "users"), (snap) => { adminDashboardEl.studentCount.textContent = snap.size; }); onSnapshot(collection(db, "opinions"), (snap) => { adminDashboardEl.opinionsCount.textContent = snap.size; }); onSnapshot(collection(db, "ratings"), (snap) => { adminDashboardEl.ratingsCount.textContent = snap.size; }); onSnapshot(query(collection(db, "users"), orderBy('createdAt', 'desc')), s => { let h = ''; s.forEach(d => { const u = d.data(), b = u.isBanned || false; h += `<div class="glass-effect p-4 rounded-lg"><div class="flex justify-between items-center"><div><p class="font-bold text-lg text-white">${u.name}</p><p class="text-sm text-slate-400">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ${u.password}</p></div><div class="flex gap-2"><button onclick="toggleBan('${d.id}', ${b})" class="px-3 py-1 text-sm rounded ${b ? 'bg-green-600' : 'bg-yellow-600'}">${b ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¸Ø±' : 'Ø­Ø¸Ø±'}</button><button onclick="deleteUser('${d.id}')" class="px-3 py-1 text-sm rounded bg-red-600">Ø­Ø°Ù</button></div></div><div class="mt-2 pt-2 border-t border-slate-700/50 text-xs text-slate-300"><div class="flex justify-between"><span>ÙØ±Ù‚Ø© ${u.year} | ${u.division}</span><span class="text-slate-500">Ø³Ø¬Ù„ ÙÙŠ: ${u.createdAt ? u.createdAt.toDate().toLocaleString('ar-EG-u-nu-latn', { day:'numeric', month:'numeric', year:'numeric', hour:'numeric', minute:'numeric'}) : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span></div><div class="mt-2 text-slate-400"><p class="truncate"><b>IP:</b> ${u.ipAddress || 'N/A'}</p><p class="truncate"><b>Ø§Ù„Ø¬Ù‡Ø§Ø²:</b> ${u.userAgent || 'N/A'}</p></div></div></div>`; }); adminDashboardEl.studentsList.innerHTML = h; }); onSnapshot(query(collection(db, "opinions"), orderBy('createdAt', 'desc')), s => { let h = ''; s.forEach(d => { const o = d.data(); h += `<div class="glass-effect p-4 rounded-lg flex justify-between items-start"><div><p>"${o.text}"</p><p class="text-sm text-slate-400 mt-2 font-bold">${o.name} - ÙØ±Ù‚Ø© ${o.year}</p></div><button onclick="deleteOpinion('${d.id}')" class="px-3 py-1 text-sm rounded bg-red-600">Ø­Ø°Ù</button></div>`; }); adminDashboardEl.opinionsList.innerHTML = h; }); onSnapshot(query(collection(db, "courses"), orderBy('title')), s => { let h = ''; s.forEach(d => { const c = d.data(); h += `<div class="glass-effect p-4 rounded-lg flex justify-between items-start"><div><p class="font-bold text-white">${c.title}</p><p class="text-sm text-slate-400">${c.desc}</p></div><button onclick="deleteCourse('${d.id}')" class="px-3 py-1 text-sm rounded bg-red-600">Ø­Ø°Ù</button></div>`; }); adminDashboardEl.coursesList.innerHTML = h; }); onSnapshot(query(collection(db, "ai_tools"), orderBy('name')), s => { let h = ''; s.forEach(d => { const t = d.data(); h += `<div class="glass-effect p-4 rounded-lg flex justify-between items-start"><div><p class="font-bold text-white">${t.name}</p><p class="text-sm text-slate-400">${t.desc}</p></div><button onclick="deleteAITool('${d.id}')" class="px-3 py-1 text-sm rounded bg-red-600">Ø­Ø°Ù</button></div>`; }); adminDashboardEl.aiToolsList.innerHTML = h; }); const ratingsQuery = query(collection(db, "ratings"), orderBy('ratedAt', 'desc')); onSnapshot(ratingsQuery, s => { let h = ''; if(s.empty){ h='<p class="text-center text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø¨Ø¹Ø¯.</p>'; } else {s.forEach(d => { const r = d.data(); const stars = 'â­'.repeat(r.rating) + 'â˜†'.repeat(5 - r.rating); const year = r.year === '1' ? 'Ø§Ù„Ø£ÙˆÙ„Ù‰' : 'Ø§Ù„Ø«Ø§Ù†ÙŠØ©'; const division = r.division === 'international' ? 'Ø£Ø¹Ù…Ø§Ù„ Ø¯ÙˆÙ„ÙŠØ©' : 'Ù†Ø¸Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª'; h += `<div class="glass-effect p-4 rounded-lg"><div class="flex justify-between items-center"><div><p class="font-bold text-lg text-white">${r.name}</p><p class="text-sm text-yellow-400">${stars}</p></div><p class="text-xs text-slate-500">${r.ratedAt ? r.ratedAt.toDate().toLocaleString('ar-EG-u-nu-latn') : ''}</p></div><div class="mt-2 pt-2 border-t border-slate-700/50 text-xs text-slate-300"><span>ÙØ±Ù‚Ø© ${year} | ${division}</span></div></div>`; });} adminDashboardEl.ratingsList.innerHTML = h; }); const contentFilters = ['content-type-select', 'content-year-select', 'content-division-select']; contentFilters.forEach(id => document.getElementById(id).addEventListener('change', displayAdminContent)); adminContentPanelEl.subject.addEventListener('change', displayAdminContent); const updateSubjects = () => { const y = adminContentPanelEl.year.value, d = adminContentPanelEl.division.value; adminContentPanelEl.subject.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>'; if (y && d) { (materials[`${y}_${d}`] || []).forEach(s => { const o = document.createElement('option'); o.value = s; o.textContent = s; adminContentPanelEl.subject.appendChild(o); }); } displayAdminContent(); }; adminContentPanelEl.year.addEventListener('change', updateSubjects); adminContentPanelEl.division.addEventListener('change', updateSubjects); const meetingToggle = document.getElementById('meeting-toggle'), meetingUrlContainer = document.getElementById('meeting-url-container'), meetingUrlInput = document.getElementById('meeting-url-input'), saveMeetingUrlBtn = document.getElementById('save-meeting-url-btn'), siteSettingsRef = doc(db, 'settings', 'site'); getDoc(siteSettingsRef).then(docSnap => { if (docSnap.exists()) { const d = docSnap.data(); meetingToggle.checked = d.meetingActive || false; meetingUrlInput.value = d.meetingUrl || ''; if (d.meetingActive) meetingUrlContainer.classList.remove('hidden'); } }); meetingToggle.addEventListener('change', e => { const i = e.target.checked; setDoc(siteSettingsRef, { meetingActive: i }, { merge: true }); if (i) meetingUrlContainer.classList.remove('hidden'); else meetingUrlContainer.classList.add('hidden'); }); saveMeetingUrlBtn.addEventListener('click', () => { const u = meetingUrlInput.value.trim(); if(u) { setDoc(siteSettingsRef, { meetingUrl: u }, { merge: true }); showToast('ØªÙ… Ø­ÙØ¸ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙŠØªÙ†Ø¬.'); } else { showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­.', true); } }); }
        async function displayAdminContent() { const { type, year, division, subject, contentList } = adminContentPanelEl; const coll = type.value; const filters = [ where("year", "==", year.value), where("division", "==", division.value) ]; if (subject.value) filters.push(where("subject", "==", subject.value)); if (!year.value || !division.value) { contentList.innerHTML = '<p class="text-center text-slate-400">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ù‚Ø© ÙˆØ§Ù„Ø´Ø¹Ø¨Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰.</p>'; return; } const q = query(collection(db, coll), ...filters); onSnapshot(q, (snapshot) => { let h = ''; if (snapshot.empty) { h = '<p class="text-center text-slate-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ù…Ø¶Ø§Ù ÙŠØ·Ø§Ø¨Ù‚ Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±.</p>'; } else { snapshot.forEach(doc => { const item = doc.data(); h += `<div class="p-3 rounded-lg flex justify-between items-center hover:bg-slate-500/10 transition"><p class="font-semibold text-white truncate">${item.title} (${item.subject})</p><div class="flex gap-2"><button onclick="populateContentForm('${doc.id}', '${coll}')" class="text-sky-400 hover:text-sky-300 text-lg"><i class="ph-pencil-simple"></i></button><button onclick="toggleContentVisibility('${doc.id}', '${coll}', ${item.isHidden || false})" class="text-yellow-400 hover:text-yellow-300 text-lg"><i class="ph ${item.isHidden ? 'ph-eye-slash' : 'ph-eye'}"></i></button><button onclick="deleteContent('${doc.id}', '${coll}')" class="text-red-500 hover:text-red-400 text-lg"><i class="ph-trash"></i></button></div></div>`; }); } contentList.innerHTML = h; }); }
        window.populateContentForm = async (id, coll) => { const docRef = doc(db, coll, id); const docSnap = await getDoc(docRef); if (docSnap.exists()) { const item = docSnap.data(); adminContentPanelEl.title.value = item.title; adminContentPanelEl.body.value = item.body; adminContentPanelEl.subject.value = item.subject; adminContentPanelEl.formTitle.textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ'; adminContentPanelEl.saveBtn.textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'; adminContentPanelEl.cancelBtn.classList.remove('hidden'); currentEditState = { id, collection: coll }; } }
        function resetContentForm() { adminContentPanelEl.formTitle.textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯'; adminContentPanelEl.saveBtn.textContent = 'Ø­ÙØ¸'; adminContentPanelEl.cancelBtn.classList.add('hidden'); adminContentPanelEl.title.value = ''; adminContentPanelEl.body.value = ''; currentEditState = { id: null, collection: null }; }
        adminContentPanelEl.cancelBtn.addEventListener('click', resetContentForm);
        window.deleteContent = async (id, coll) => { try { if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŸ')) { await deleteDoc(doc(db, coll, id)); showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰.'); } } catch(e) { showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message, true); } };
        window.toggleContentVisibility = async (id, coll, isHidden) => { try { await updateDoc(doc(db, coll, id), { isHidden: !isHidden }); showToast(`ØªÙ… ${isHidden ? 'Ø¥Ø¸Ù‡Ø§Ø±' : 'Ø¥Ø®ÙØ§Ø¡'} Ø§Ù„Ù…Ø­ØªÙˆÙ‰.`); } catch(e) { showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message, true); }};
        window.toggleBan = async (id, ban) => { try { if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${ban ? 'Ø¥Ù„ØºØ§Ø¡ Ø­Ø¸Ø±' : 'Ø­Ø¸Ø±'} Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ`)) { await updateDoc(doc(db, 'users', id), { isBanned: !ban }); showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨.'); } } catch(e){ showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message, true); } };
        window.deleteUser = async (id) => { try { if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) { await deleteDoc(doc(db, 'users', id)); showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨.'); } } catch(e){ showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message, true); } };
        window.deleteOpinion = async (id) => { try { if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø±Ø£ÙŠØŸ')) { await deleteDoc(doc(db, 'opinions', id)); showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø£ÙŠ.'); } } catch(e) { showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message, true) }};
        window.deleteCourse = async (id) => { try { if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ±Ø³ØŸ')) { await deleteDoc(doc(db, 'courses', id)); showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ±Ø³.'); } } catch(e) { showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message, true) }};
        window.deleteAITool = async (id) => { try { if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø£Ø¯Ø§Ø©ØŸ')) { await deleteDoc(doc(db, 'ai_tools', id)); showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø£Ø¯Ø§Ø©.'); } } catch(e) { showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message, true) }};
        adminContentPanelEl.saveBtn.addEventListener('click', async () => { try { const { year, division, subject, title, body, type } = adminContentPanelEl; const data = { year: year.value, division: division.value, subject: subject.value, title: title.value.trim(), body: body.value.trim(), isHidden: false }; if (!data.year || !data.division || !data.subject || !data.title || !data.body) { showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', true); return; } if (currentEditState.id) { await updateDoc(doc(db, currentEditState.collection, currentEditState.id), data); showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­!'); } else { data.createdAt = serverTimestamp(); await addDoc(collection(db, type.value), data); showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­!'); } resetContentForm(); } catch(e) { showToast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message, true); }});
        document.getElementById('add-course-btn').addEventListener('click', async () => { const title = document.getElementById('course-title-input').value.trim(), desc = document.getElementById('course-desc-input').value.trim(), url = document.getElementById('course-url-input').value.trim(); if (!title || !desc || !url) { showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', true); return; } await addDoc(collection(db, 'courses'), { title, desc, url }); showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ±Ø³ Ø¨Ù†Ø¬Ø§Ø­!'); document.getElementById('course-title-input').value = ''; document.getElementById('course-desc-input').value = ''; document.getElementById('course-url-input').value = ''; });
        document.getElementById('add-ai-tool-btn').addEventListener('click', async () => { const name = document.getElementById('ai-name-input').value.trim(), desc = document.getElementById('ai-desc-input').value.trim(), url = document.getElementById('ai-url-input').value.trim(); if (!name || !desc || !url) { showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', true); return; } await addDoc(collection(db, 'ai_tools'), { name, desc, url }); showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¯Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­!'); document.getElementById('ai-name-input').value = ''; document.getElementById('ai-desc-input').value = ''; document.getElementById('ai-url-input').value = ''; });
        let timerInterval; let timerState = { running: false, duration: 25 * 60 };
        function formatTime(seconds) { const m = Math.floor(seconds / 60); const s = seconds % 60; return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`; }
        function updateTimerDisplay() { const display = document.getElementById('timer-display'); if(display) display.textContent = formatTime(timerState.duration); }
        function startTimer() { studentDashboardEl.timerIndicator.classList.remove('hidden'); timerState.running = true; document.getElementById('timer-start-btn').textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª'; timerInterval = setInterval(() => { timerState.duration--; updateTimerDisplay(); if (timerState.duration < 0) { stopTimer(true); } }, 1000); }
        function stopTimer(finished = false) { clearInterval(timerInterval); studentDashboardEl.timerIndicator.classList.add('hidden'); timerState.running = false; const startBtn = document.getElementById('timer-start-btn'); if(startBtn) startBtn.textContent = 'Ø¨Ø¯Ø¡'; if(finished){ document.getElementById('generic-modal').classList.remove('open'); openModalWithContent('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!', '<div class="text-center p-8"><i class="ph-confetti text-6xl text-[var(--primary-glow)] mb-4"></i><h3 class="text-xl font-bold mb-2">Ø£Ø­Ø³Ù†Øª!</h3><p class="text-slate-400">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø¬Ù„Ø³Ø© Ù…Ø°Ø§ÙƒØ±Ø©. Ø®Ø° Ù‚Ø³Ø·Ø§Ù‹ Ù…Ù† Ø§Ù„Ø±Ø§Ø­Ø©.</p></div>'); timerState.duration = 25*60; } }
        function handleTimerClick() { if (timerState.running) { stopTimer(); } else { startTimer(); } }
        function handleTimerReset() { stopTimer(); timerState.duration = 25 * 60; updateTimerDisplay(); }
        document.body.addEventListener('click', async e => { if (e.target.id === 'submit-opinion-btn') { const input = document.getElementById('opinion-input'); const text = input.value.trim(); if (!text) { showToast('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù†Ø´Ø± Ø±Ø£ÙŠ ÙØ§Ø±Øº', true); return; } e.target.disabled = true; e.target.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„Ù†Ø´Ø±...'; await addDoc(collection(db, "opinions"), { name: currentUser.name, year: currentUser.year, text, createdAt: serverTimestamp() }); showToast('ØªÙ… Ù†Ø´Ø± Ø±Ø£ÙŠÙƒ Ø¨Ù†Ø¬Ø§Ø­!'); input.value = ''; e.target.disabled = false; e.target.textContent = 'Ù†Ø´Ø± Ø§Ù„Ø±Ø£ÙŠ'; } if(e.target.classList.contains('theme-btn')) { const theme = e.target.dataset.theme; if (theme) { document.documentElement.dataset.theme = theme; const settingsModal = e.target.closest('#generic-modal'); if (settingsModal && settingsModal.querySelector('.settings-option')) { settingsModal.querySelectorAll('.theme-btn.settings-option').forEach(b => b.classList.remove('selected')); e.target.classList.add('selected'); } } } if(e.target.id === 'logout-btn') { handleLogout(); } if(e.target.id === 'clear-data-btn') { if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø­Ùˆ Ø¨ÙŠØ§Ù†Ø§ØªÙƒØŸ Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ.')) { sessionStorage.removeItem('moraUser'); currentUser = null; location.reload(); }} if(e.target.id === 'rate-site-btn') { const container = document.getElementById('rating-container'); container.innerHTML = `<div class="flex justify-center text-2xl text-yellow-400 cursor-pointer">${[1,2,3,4,5].map(i => `<i class="ph-star rating-star" data-value="${i}"></i>`).join('')}</div>`; } if(e.target.classList.contains('rating-star')) { const rating = e.target.dataset.value; await addDoc(collection(db, "ratings"), { userId: currentUser.id, name: currentUser.name, rating: Number(rating), year: currentUser.year, division: currentUser.division, ratedAt: serverTimestamp() }); const container = document.getElementById('rating-container'); container.innerHTML = `<p class="text-center text-sm p-2 text-green-400">Ø´ÙƒØ±Ø§Ù‹ ${currentUser.name} Ù„ØªÙ‚ÙŠÙŠÙ…Ùƒ!</p>`; setTimeout(() => container.innerHTML = `<button id="my-blog-btn" class="w-full p-2 rounded-lg hover:bg-slate-500/20 transition">Ù…Ø¯ÙˆÙ†ØªÙŠ</button>`, 2000); } if(e.target.id === 'my-blog-btn') { openModalWithContent('Ù…Ø¯ÙˆÙ†ØªÙŠ', '<textarea id="blog-input" class="w-full p-3 rounded-lg input-field" rows="8" placeholder="Ø§ÙƒØªØ¨ Ù…Ø§ ÙŠØ¯ÙˆØ± ÙÙŠ Ø°Ù‡Ù†Ùƒ..."></textarea><button id="save-blog-btn" class="w-full mt-2 py-2 rounded-lg font-bold btn-celestial">Ø­ÙØ¸</button>'); } if(e.target.id === 'privacy-policy-btn') { openModalWithContent('Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©', '<div class="p-2 text-sm text-slate-300 space-y-3"><p><strong>Ù…Ù‚Ø¯Ù…Ø©:</strong> Ù†Ø­Ù† ÙÙŠ Ù…Ù†ØµØ© "Mora For Studying" Ù†Ø£Ø®Ø° Ø®ØµÙˆØµÙŠØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¹Ù„Ù‰ Ù…Ø­Ù…Ù„ Ø§Ù„Ø¬Ø¯. ØªÙˆØ¶Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© ÙƒÙŠÙÙŠØ© Ø¬Ù…Ø¹ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ­Ù…Ø§ÙŠØ© Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©.</p><p><strong>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ Ù†Ø¬Ù…Ø¹Ù‡Ø§:</strong> Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©: Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©ØŒ ÙˆØ§Ù„Ø´Ø¹Ø¨Ø©. ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø· Ù„ØºØ±Ø¶ ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ Ù„Ùƒ ÙˆØ¶Ù…Ø§Ù† ÙˆØµÙˆÙ„Ùƒ Ù„Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØµØ­ÙŠØ­Ø©.</p><p><strong>Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> Ù„Ø§ ÙŠØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…Ø¹ Ø£ÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø« ØªØ­Øª Ø£ÙŠ Ø¸Ø±Ù Ù…Ù† Ø§Ù„Ø¸Ø±ÙˆÙ. ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹ Ù„ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©.</p><p class="font-bold text-red-400 border-t border-red-500/30 pt-3 mt-3"><strong>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ø§Ø¯Ù„:</strong> ØªÙ… ØªØµÙ…ÙŠÙ… Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†ØµØ© Ù„ØºØ±Ø¶ ØªØ¹Ù„ÙŠÙ…ÙŠ Ø¨Ø­Øª. ÙŠÙÙ…Ù†Ø¹ Ù…Ù†Ø¹Ø§Ù‹ Ø¨Ø§ØªØ§Ù‹ Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø¥Ø³Ø§Ø¡Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø£Ùˆ Ù†Ø´Ø± Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù„Ø§Ø¦Ù‚ØŒ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙŠ ÙˆØ³ÙŠÙ„Ø© Ù„Ù„ØªØ­Ø§ÙŠÙ„ Ø¹Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· Ø£Ùˆ Ø§Ù„ÙˆØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­ Ø¨Ù‡. Ø£ÙŠ Ø®Ø±Ù‚ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø³ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ <strong>Ø§Ù„Ø­Ø¸Ø± Ø§Ù„ÙÙˆØ±ÙŠ ÙˆØ§Ù„Ø¯Ø§Ø¦Ù… Ù„Ù„Ø­Ø³Ø§Ø¨</strong> Ø¯ÙˆÙ† Ø³Ø§Ø¨Ù‚ Ø¥Ù†Ø°Ø§Ø± Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø·ÙˆØ±.</p><p class="text-xs text-slate-500 text-center pt-3">ØªØ·ÙˆÙŠØ± Amr lotfy</p></div>'); } if(e.target.id === 'study-timer-btn') { openModalWithContent('ØªØ§ÙŠÙ…Ø± Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©', `<div class="text-center p-4 flex flex-col items-center"><p id="timer-display" class="text-6xl font-mono tracking-widest mb-6">${formatTime(timerState.duration)}</p><div class="flex gap-4"><button id="timer-start-btn" class="w-24 py-2 rounded-lg text-base font-bold btn-celestial">Ø¨Ø¯Ø¡</button><button id="timer-reset-btn" class="w-24 py-2 rounded-lg text-base font-bold btn-celestial border-amber-500 text-amber-500 hover:bg-amber-500 hover:text-black">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button></div></div>`); document.getElementById('timer-start-btn').onclick = handleTimerClick; document.getElementById('timer-reset-btn').onclick = handleTimerReset; } });
        document.querySelectorAll('.bottom-nav-btn[data-modal]').forEach(btn => btn.addEventListener('click', async e => {
            const type = e.currentTarget.dataset.modal;
            if (currentContentUnsubscribe) currentContentUnsubscribe();
            if (type === 'opinions-modal') { openModalWithContent('Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨', `<div id="opinions-view" class="space-y-3 mb-4 max-h-60 overflow-y-auto"></div><textarea id="opinion-input" class="w-full rounded-lg input-field mt-4" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø±Ø£ÙŠÙƒ Ù‡Ù†Ø§..."></textarea><button id="submit-opinion-btn" class="w-full mt-2 py-2 rounded-lg font-bold btn-celestial">Ù†Ø´Ø± Ø§Ù„Ø±Ø£ÙŠ</button>`); onSnapshot(query(collection(db, "opinions"), orderBy('createdAt', 'desc')), snap => { document.getElementById('opinions-view').innerHTML = snap.docs.map(d => { const o = d.data(); return `<div class="p-3 rounded-lg hover:bg-slate-500/10"><p>"${o.text}"</p><p class="text-xs text-slate-400 mt-2 font-bold">${o.name} - ÙØ±Ù‚Ø© ${o.year}</p></div>`; }).join('') || '<p class="text-center text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¢Ø±Ø§Ø¡ Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙƒØªØ¨ Ø±Ø£ÙŠØ§Ù‹!</p>'; }); }
            if (type === 'about-modal') { 
                const aboutHTML = `<div class="text-center p-2 flex flex-col items-center space-y-4 w-full"><p class="text-lg text-slate-300">Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø®Ø§Øµ Ø¨Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠØ© Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ø§Ù„Ø¹Ø§Ù„ÙŠ Ù„Ù„Ø­Ø§Ø³Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ø·Ù†Ø·Ø§.</p><div class="my-2"><p class="font-bold text-lg text-shadow-lg" style="color:var(--primary-glow)">ØªØ·ÙˆÙŠØ± Amr lotfy</p></div><hr class="w-full border-t border-[var(--glass-border)]"><p class="font-bold text-slate-400">ØªØ­Øª Ø±Ø¹Ø§ÙŠØ©</p><div class="space-y-2"><p class="font-bold" style="color:var(--primary-glow); text-shadow: 0 0 10px var(--primary-glow);">Ø§. Ø¯/ Ø¹Ø¨Ø¯Ø§Ù„Ù…Ù†Ø¹Ù… Ø§Ù„Ø¯Ø³ÙˆÙ‚ÙŠ</p><p class="font-bold" style="color:var(--primary-glow); text-shadow: 0 0 10px var(--primary-glow);">Ø§. Ø¯/Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ù…Ø§Ø±ÙŠÙ‡</p><p class="font-bold" style="color:var(--primary-glow); text-shadow: 0 0 10px var(--primary-glow);">Ø§. Ø¯/Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯Ø§Ù„Ù…Ù†Ø¹Ù…</p><p class="font-bold" style="color:var(--primary-glow); text-shadow: 0 0 10px var(--primary-glow);">Ø§. Ø¯/Ù…Ø­Ù…Ø¯ Ø­Ø¬Ø§Ø²ÙŠ</p></div><hr class="w-full border-t border-[var(--glass-border)]"><div class="flex justify-center items-center gap-6 my-2"><a href="#" onclick="event.preventDefault(); handleLinkRedirect('https://wa.me/201067941806')" class="social-icon-animated text-3xl" style="color: #25D366; --glow-color: #25D366; animation-delay: 0s;"><i class="ph-whatsapp-logo"></i></a><a href="#" onclick="event.preventDefault(); handleLinkRedirect('https://www.facebook.com/share/1CDtFCSPVD/')" class="social-icon-animated text-3xl" style="color: #1877F2; --glow-color: #1877F2; animation-delay: -2s;"><i class="ph-facebook-logo"></i></a><a href="#" onclick="event.preventDefault(); handleLinkRedirect('mailto:amrloutfy2006@gmail.com')" class="social-icon-animated text-3xl" style="color: #EA4335; --glow-color: #EA4335; animation-delay: -4s;"><i class="ph-envelope"></i></a></div><p class="text-sm text-slate-500">Ø¥ØµØ¯Ø§Ø± 11.0</p><div class="w-full max-w-xs space-y-2 text-sm" id="about-buttons-container"><div id="rating-container"><button id="rate-site-btn" class="w-full p-2 rounded-lg hover:bg-slate-500/20 transition">Ù‚ÙŠÙ… Ø§Ù„Ù…ÙˆÙ‚Ø¹</button></div><button id="study-timer-btn" class="w-full p-2 rounded-lg hover:bg-slate-500/20 transition">ØªØ§ÙŠÙ…Ø± Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</button><button id="privacy-policy-btn" class="w-full p-2 rounded-lg hover:bg-slate-500/20 transition">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</button></div><div class="w-full max-w-xs grid grid-cols-2 gap-2 mt-4"><button id="clear-data-btn" class="w-full py-2 rounded-lg text-sm btn-celestial">Ù…Ø­Ùˆ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button><button id="logout-btn" class="w-full py-2 rounded-lg text-sm btn-celestial border-red-500 text-red-500 hover:bg-red-500 hover:text-white">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button></div></div>`;
                openModalWithContent('Ø¹Ù† Ø§Ù„Ù…Ù†ØµØ©', aboutHTML);
            }
            if (type === 'settings-modal') {
                const currentTheme = document.documentElement.dataset.theme || 'default';
                const settingsHTML = `
                    <div class="space-y-6 p-2">
                        <h4 class="text-lg font-semibold text-slate-400 -mt-2">Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ù„ÙˆÙ†ÙŠ</h4>
                        <div>
                            <h3 class="text-md font-bold mb-3 text-slate-300">Ø§Ù„Ù„ØºØ©</h3>
                            <div class="space-y-3">
                                <div class="settings-option selected" onclick="showToast('Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù‡ÙŠ Ø§Ù„Ù…ÙØ¹Ù‘Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹')">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
                                <div class="settings-option" onclick="showToast('Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø¨Ø¹Ø¯')">English</div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-md font-bold mb-3 text-slate-300">Ø§Ù„ÙˆØ¶Ø¹</h3>
                             <div class="grid grid-cols-2 gap-3">
                                <div data-theme="default" class="theme-btn settings-option ${currentTheme === 'default' ? 'selected' : ''}">Ø¯Ø§ÙƒÙ†</div>
                                <div data-theme="gold" class="theme-btn settings-option ${currentTheme === 'gold' ? 'selected' : ''}">Ø°Ù‡Ø¨ÙŠ</div>
                                <div data-theme="emerald" class="theme-btn settings-option ${currentTheme === 'emerald' ? 'selected' : ''}">Ø²Ù…Ø±Ø¯ÙŠ</div>
                                <div data-theme="crimson" class="theme-btn settings-option ${currentTheme === 'crimson' ? 'selected' : ''}">Ù‚Ø±Ù…Ø²ÙŠ</div>
                            </div>
                        </div>
                    </div>
                `;
                openModalWithContent('Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', settingsHTML);
            }
            if (type === 'ai-tools-modal') { const q = query(collection(db, "ai_tools")); const snapshot = await getDocs(q); let content = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">'; if(snapshot.empty){ content += '<p class="md:col-span-2 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯ÙˆØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>'; } else { snapshot.forEach(doc => { const t = doc.data(); content += `<div onclick="handleAIRedirect('${t.url}')" class="p-3 rounded-lg cursor-pointer transition-all duration-300 hover:bg-slate-500/20"><h5 class="font-bold text-white">${t.name}</h5><p class="text-xs text-slate-400">${t.desc}</p></div>`; }); } content += '</div>'; openModalWithContent('Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', content); }
        }));
        function showCountdownModal(title, callback) { openModalWithContent(title, `<div class="text-center p-8"><p class="text-lg">Ø³ÙŠØªÙ… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø®Ù„Ø§Ù„ <span id="countdown-span" class="font-bold text-xl text-[var(--primary-glow)]">3</span>...</p><p class="mt-6 text-sm text-[var(--primary-glow)]">ØªØ·ÙˆÙŠØ± Amr lotfy</p></div>`); let count = 3; const countdownSpan = document.getElementById('countdown-span'); const interval = setInterval(() => { count--; countdownSpan.textContent = count > 0 ? count + '...' : 'Ø§Ù„Ø¢Ù†!'; if (count <= 0) { clearInterval(interval); callback(); } }, 1000); }
        window.handleLinkRedirect = (url) => { showCountdownModal('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...', () => { window.open(url, '_blank'); document.getElementById('generic-modal').classList.remove('open'); }); };
        window.handleAIRedirect = (url) => { showCountdownModal('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...', () => { window.open(url, '_blank'); document.getElementById('generic-modal').classList.remove('open'); }); };
        function handleLogout() { if (!currentUser) return; const userToLogOut = { ...currentUser }; showCountdownModal('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', () => { sessionStorage.removeItem('moraUser'); currentUser = null; document.getElementById('generic-modal').classList.remove('open'); showPage('auth-page'); renderAuthForm(false, false); if (userToLogOut.isAdmin) { document.getElementById('auth-name').value = 'admen'; document.getElementById('auth-password').value = 'Amr1221@gmail.com'; } else { document.getElementById('auth-name').value = userToLogOut.name; document.getElementById('auth-password').value = userToLogOut.password; } initVantaBackground(); });}
        async function setupInitialData() { 
            const aiToolsRef = collection(db, 'ai_tools'); 
            const aiSnapshot = await getDocs(query(aiToolsRef)); 
            if (aiSnapshot.empty) { 
                const initialTools = [ { name: "ChatGPT", desc: "Ù†Ù…ÙˆØ°Ø¬ Ù„ØºÙˆÙŠ Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.", url: "https://chat.openai.com/" }, { name: "Midjourney", desc: "ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ± ÙÙ†ÙŠØ© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø© Ù…Ù† Ø§Ù„Ù†ØµÙˆØµ.", url: "https://www.midjourney.com/" }, { name: "Canva AI", desc: "Ø£Ø¯ÙˆØ§Øª Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø±Ø§ÙÙŠÙƒÙŠ.", url: "https://www.canva.com/ai-image-generator/" }, { name: "Notion AI", desc: "Ù…Ø³Ø§Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© ÙˆØªÙ†Ø¸ÙŠÙ… Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª.", url: "https://www.notion.so/product/ai" }, { name: "Grammarly", desc: "ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù†Ø­ÙˆÙŠØ© ÙˆØ§Ù„Ø¥Ù…Ù„Ø§Ø¦ÙŠØ© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©.", url: "https://www.grammarly.com/" }, { name: "Synthesia", desc: "Ø¥Ù†Ø´Ø§Ø¡ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø´Ø®ØµÙŠØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.", url: "https://www.synthesia.io/" }, { name: "Fireflies.ai", desc: "ØªÙ„Ø®ÙŠØµ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª ÙˆØ§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©.", url: "https://fireflies.ai/" }, { name: "Descript", desc: "ØªØ­Ø±ÙŠØ± Ø§Ù„ØµÙˆØª ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø³Ù‡ÙˆÙ„Ø© Ù…Ø«Ù„ ØªØ­Ø±ÙŠØ± Ø§Ù„Ù†ØµÙˆØµ.", url: "https://www.descript.com/" }, { name: "SlidesAI", desc: "Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±ÙˆØ¶ ØªÙ‚Ø¯ÙŠÙ…ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ù† Ø§Ù„Ù†ØµÙˆØµ.", url: "https://www.slidesai.io/" }, { name: "GitHub Copilot", desc: "Ù…Ø³Ø§Ø¹Ø¯ Ø¨Ø±Ù…Ø¬ÙŠ ÙŠÙƒÙ…Ù„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙˆÙŠÙ‚ØªØ±Ø­Ù‡Ø§.", url: "https://github.com/features/copilot" }, { name: "Remove.bg", desc: "Ø¥Ø²Ø§Ù„Ø© Ø®Ù„ÙÙŠØ§Øª Ø§Ù„ØµÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ¨Ø¯Ù‚Ø©.", url: "https://www.remove.bg/" }, { name: "Lumen5", desc: "ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø¥Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù‚ØµÙŠØ±Ø©.", url: "https://lumen5.com/" }, { name: "Otter.ai", desc: "ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ© Ø¥Ù„Ù‰ Ù†ØµÙˆØµ Ù…ÙƒØªÙˆØ¨Ø©.", url: "https://otter.ai/" }, { name: "Runway ML", desc: "Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ø¯ÙˆØ§Øª Ù„ØªØ­Ø±ÙŠØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.", url: "https://runwayml.com/" }, { name: "Perplexity AI", desc: "Ù…Ø­Ø±Ùƒ Ø¨Ø­Ø« Ù…Ø­Ø§Ø¯Ø«ÙŠ ÙŠÙ‚Ø¯Ù… Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©.", url: "https://www.perplexity.ai/" }, { name: "DALL-E 3", desc: "Ù†Ù…ÙˆØ°Ø¬ ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ± Ù…Ù† Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† OpenAI.", url: "https://openai.com/dall-e-3" }, { name: "ElevenLabs", desc: "ØªÙˆÙ„ÙŠØ¯ Ø£ØµÙˆØ§Øª Ø¨Ø´Ø±ÙŠØ© ÙˆØ§Ù‚Ø¹ÙŠØ© Ù…Ù† Ø§Ù„Ù†ØµÙˆØµ.", url: "https://elevenlabs.io/" }, { name: "Tome", desc: "Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±ÙˆØ¶ ØªÙ‚Ø¯ÙŠÙ…ÙŠØ© ÙˆÙ‚ØµØµ Ù…Ø±Ø¦ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.", url: "https://tome.app/" }, { name: "HeyGen", desc: "Ø¥Ù†Ø´Ø§Ø¡ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ Ø´Ø®ØµÙŠØ§Øª Ø±Ù…Ø²ÙŠØ©.", url: "https://www.heygen.com/" }, { name: "DeepL", desc: "ØªØ±Ø¬Ù…Ø© Ù†ØµÙˆØµ Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„ØºØ§ÙŠØ© ÙˆØ¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©.", url: "https://www.deepl.com/translator" } ]; 
                for (const tool of initialTools) { await addDoc(aiToolsRef, tool); } 
                console.log("Initial AI tools have been added to Firestore."); 
            }
        }
        window.addEventListener('load', () => { setupInitialData(); const savedUser = sessionStorage.getItem('moraUser'); if (savedUser) { currentUser = JSON.parse(savedUser); showPage('splash-screen'); } else { showPage('auth-page'); renderAuthForm(); initVantaBackground(); } });
        document.getElementById('splash-screen').addEventListener('animationend', () => { setTimeout(() => { if (currentUser.isAdmin) { initAdminDashboard(); } else { initStudentDashboard(); } }, 1000); });
        document.getElementById('admin-logout-btn').addEventListener('click', handleLogout);
        document.getElementById('generic-modal').addEventListener('click', e => { if (e.target.classList.contains('modal') || e.target.closest('.modal-close-btn')) { if(currentContentUnsubscribe) currentContentUnsubscribe(); document.getElementById('generic-modal').classList.remove('open'); } });
    </script>
</body>
</html>
